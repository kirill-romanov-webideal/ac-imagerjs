const modules=[];(function(){"use strict";function e(e){return JSON.parse(JSON.stringify(e))}function t(e){for(var t=g(e);"\xFF\xE0"<=t[1].slice(0,2)&&"\xFF\xEF">=t[1].slice(0,2);)t=[t[0]].concat(t.slice(2));return t.join("")}function a(e){return l(">"+d("B",e.length),e)}function i(e){return l(">"+d("H",e.length),e)}function o(e){return l(">"+d("L",e.length),e)}function n(e,t,r){var s,p,g,c,m="",h="";if("Byte"==t)s=e.length,4>=s?h=a(e)+d("\0",4-s):(h=l(">L",[r]),m=a(e));else if("Short"==t)s=e.length,2>=s?h=i(e)+d("\0\0",2-s):(h=l(">L",[r]),m=i(e));else if("Long"==t)s=e.length,1>=s?h=o(e):(h=l(">L",[r]),m=o(e));else if("Ascii"==t)p=e+"\0",s=p.length,4<s?(h=l(">L",[r]),m=p):h=p+d("\0",4-s);else if("Rational"==t){if("number"==typeof e[0])s=1,g=e[0],c=e[1],p=l(">L",[g])+l(">L",[c]);else{s=e.length,p="";for(var u=0;u<s;u++)g=e[u][0],c=e[u][1],p+=l(">L",[g])+l(">L",[c])}h=l(">L",[r]),m=p}else if("SRational"==t){if("number"==typeof e[0])s=1,g=e[0],c=e[1],p=l(">l",[g])+l(">l",[c]);else{s=e.length,p="";for(var u=0;u<s;u++)g=e[u][0],c=e[u][1],p+=l(">l",[g])+l(">l",[c])}h=l(">L",[r]),m=p}else"Undefined"==t&&(s=e.length,4<s?(h=l(">L",[r]),m=e):h=e+d("\0",4-s));var f=l(">L",[s]);return[f,h,m]}function r(e,t,a){var i,o=Object.keys(e).length,r=l(">H",[o]);i=-1<["0th","1st"].indexOf(t)?2+12*o+4:2+12*o;var s,p="",d="";for(var s in e){if("string"==typeof s&&(s=parseInt(s)),"0th"==t&&-1<[34665,34853].indexOf(s))continue;else if("Exif"==t&&40965==s)continue;else if("1st"==t&&-1<[513,514].indexOf(s))continue;var g=e[s],c=l(">H",[s]),m=v[t][s].type,h=l(">H",[y[m]]);"number"==typeof g&&(g=[g]);var u=8+i+a+d.length,f=n(g,m,u),S=f[0],C=f[1],b=f[2];p+=c+h+S+C,d+=b}return[r+p,d]}function s(e){var t,a;if("\xFF\xD8"==e.slice(0,2))t=g(e),a=c(t),this.tiftag=a?a.slice(10):null;else if(-1<["II","MM"].indexOf(e.slice(0,2)))this.tiftag=e;else if("Exif"==e.slice(0,4))this.tiftag=e.slice(6);else throw"Given file is neither JPEG nor TIFF."}function l(e,t){if(!(t instanceof Array))throw"'pack' error. Got invalid type argument.";if(e.length-1!=t.length)throw"'pack' error. "+(e.length-1)+" marks, "+t.length+" elements.";var a;if("<"==e[0])a=!0;else if(">"==e[0])a=!1;else throw"";for(var i="",o=1,n=null,r=null,s=null;r=e[o];){if("b"==r.toLowerCase()){if(n=t[o-1],"b"==r&&0>n&&(n+=256),255<n||0>n)throw"'pack' error.";else s=String.fromCharCode(n);}else if("H"==r){if(n=t[o-1],65535<n||0>n)throw"'pack' error.";else s=String.fromCharCode(Math.floor(n%65536/256))+String.fromCharCode(n%256),a&&(s=s.split("").reverse().join(""));}else if("l"!=r.toLowerCase())throw"'pack' error.";else if(n=t[o-1],"l"==r&&0>n&&(n+=4294967296),4294967295<n||0>n)throw"'pack' error.";else s=String.fromCharCode(Math.floor(n/16777216))+String.fromCharCode(Math.floor(n%16777216/65536))+String.fromCharCode(Math.floor(n%65536/256))+String.fromCharCode(n%256),a&&(s=s.split("").reverse().join(""));i+=s,o+=1}return i}function p(e,t){if("string"!=typeof t)throw"'unpack' error. Got invalid type argument.";for(var a=0,i=1;i<e.length;i++)if("b"==e[i].toLowerCase())a+=1;else if("h"==e[i].toLowerCase())a+=2;else if("l"==e[i].toLowerCase())a+=4;else throw"'unpack' error. Got invalid mark.";if(a!=t.length)throw"'unpack' error. Mismatch between symbol and string length. "+a+":"+t.length;var o;if("<"==e[0])o=!0;else if(">"==e[0])o=!1;else throw"'unpack' error.";for(var n=[],r=0,s=1,d=null,g=null,m=null,h="";g=e[s];){if("b"==g.toLowerCase())m=1,h=t.slice(r,r+m),d=h.charCodeAt(0),"b"==g&&128<=d&&(d-=256);else if("H"==g)m=2,h=t.slice(r,r+m),o&&(h=h.split("").reverse().join("")),d=256*h.charCodeAt(0)+h.charCodeAt(1);else if("l"==g.toLowerCase())m=4,h=t.slice(r,r+m),o&&(h=h.split("").reverse().join("")),d=16777216*h.charCodeAt(0)+65536*h.charCodeAt(1)+256*h.charCodeAt(2)+h.charCodeAt(3),"l"==g&&2147483648<=d&&(d-=4294967296);else throw"'unpack' error. "+g;n.push(d),r+=m,s+=1}return n}function d(e,t){for(var a="",o=0;o<t;o++)a+=e;return a}function g(e){if("\xFF\xD8"!=e.slice(0,2))throw"Given data isn't JPEG.";for(var t=2,a=["\xFF\xD8"];;){if("\xFF\xDA"==e.slice(t,t+2)){a.push(e.slice(t));break}else{var i=p(">H",e.slice(t+2,t+4))[0],o=t+i+2;a.push(e.slice(t,o)),t=o}if(t>=e.length)throw"Wrong JPEG data."}return a}function c(e){for(var t,a=0;a<e.length;a++)if(t=e[a],"\xFF\xE1"==t.slice(0,2))return t;return null}function m(e,t){return"\xFF\xE0"==e[1].slice(0,2)&&"\xFF\xE1"==e[2].slice(0,2)?t?(e[2]=t,e=["\xFF\xD8",t].concat(e.slice(2))):null==t?e=e.slice(0,2).concat(e.slice(3)):e=e.slice(0).concat(e.slice(2)):"\xFF\xE0"==e[1].slice(0,2)?t&&(e[1]=t):"\xFF\xE1"==e[1].slice(0,2)?t?e[1]=t:null==t&&(e=e.slice(0).concat(e.slice(2))):t&&(e=[e[0],t].concat(e.slice(1))),e.join("")}var h={};if(h.remove=function(e){var t=!1;if("\xFF\xD8"==e.slice(0,2));else if("data:image/jpeg;base64,"==e.slice(0,23)||"data:image/jpg;base64,"==e.slice(0,22))e=f(e.split(",")[1]),t=!0;else throw"Given data is not jpeg.";var a=g(e);if("\xFF\xE1"==a[1].slice(0,2))a=[a[0]].concat(a.slice(2));else if("\xFF\xE1"==a[2].slice(0,2))a=a.slice(0,2).concat(a.slice(3));else throw"Exif not found.";var i=a.join("");return t&&(i="data:image/jpeg;base64,"+u(i)),i},h.insert=function(e,t){var a=!1;if("Exif\0\0"!=e.slice(0,6))throw"Given data is not exif.";if("\xFF\xD8"==t.slice(0,2));else if("data:image/jpeg;base64,"==t.slice(0,23)||"data:image/jpg;base64,"==t.slice(0,22))t=f(t.split(",")[1]),a=!0;else throw"Given data is not jpeg.";var i="\xFF\xE1"+l(">H",[e.length+2])+e,o=g(t),n=m(o,i);return a&&(n="data:image/jpeg;base64,"+u(n)),n},h.load=function(e){var t;if("string"!=typeof e)throw"'load' got invalid type argument.";else if("\xFF\xD8"==e.slice(0,2))t=e;else if("data:image/jpeg;base64,"==e.slice(0,23))t=f(e.split(",")[1]);else if("Exif"==e.slice(0,4))t=e.slice(6);else throw"'load' got invalid file data.";var a={"0th":{},Exif:{},GPS:{},Interop:{},"1st":{},thumbnail:null},i=new s(t);if(null===i.tiftag)return a;i.endian_mark="II"==i.tiftag.slice(0,2)?"<":">";var o=p(i.endian_mark+"L",i.tiftag.slice(4,8))[0];a["0th"]=i.get_ifd(o,"0th");var n=a["0th"].first_ifd_pointer;if(delete a["0th"].first_ifd_pointer,34665 in a["0th"]&&(o=a["0th"][34665],a.Exif=i.get_ifd(o,"Exif")),34853 in a["0th"]&&(o=a["0th"][34853],a.GPS=i.get_ifd(o,"GPS")),40965 in a.Exif&&(o=a.Exif[40965],a.Interop=i.get_ifd(o,"Interop")),"\0\0\0\0"!=n&&(o=p(i.endian_mark+"L",n)[0],a["1st"]=i.get_ifd(o,"1st"),513 in a["1st"]&&514 in a["1st"])){var r=a["1st"][513]+a["1st"][514],l=i.tiftag.slice(a["1st"][513],r);a.thumbnail=l}return a},h.dump=function(a){var i,o,n,s,p,d=e(a),g=!1,c=!1,m=!1,h=!1;i="0th"in d?d["0th"]:{},("Exif"in d&&Object.keys(d.Exif).length||"Interop"in d&&Object.keys(d.Interop).length)&&(i[34665]=1,g=!0,o=d.Exif,"Interop"in d&&Object.keys(d.Interop).length&&(o[40965]=1,m=!0,n=d.Interop)),"GPS"in d&&Object.keys(d.GPS).length&&(i[34853]=1,c=!0,s=d.GPS),"1st"in d&&"thumbnail"in d&&null!=d.thumbnail&&(h=!0,d["1st"][513]=1,d["1st"][514]=1,p=d["1st"]);var u,f,v,S,C,b=r(i,"0th",0),w=b[0].length+12*g+12*c+4+b[1].length,P="",E=0,R="",x=0,I="",$=0,L="";if(g&&(u=r(o,"Exif",w),E=u[0].length+12*m+u[1].length),c&&(f=r(s,"GPS",w+E),R=f.join(""),x=R.length),m){var T=w+E+x;v=r(n,"Interop",T),I=v.join(""),$=I.length}if(h){var T=w+E+x+$;if(S=r(p,"1st",T),C=t(d.thumbnail),64e3<C.length)throw"Given thumbnail is too large. max 64kB"}var D="",A="",B="",k="\0\0\0\0";if(g){var _=8+w,H=l(">L",[_]),z=34665,G=l(">H",[z]),M=l(">H",[y.Long]),F=l(">L",[1]);D=G+M+F+H}if(c){var _=8+w+E,H=l(">L",[_]),z=34853,G=l(">H",[z]),M=l(">H",[y.Long]),F=l(">L",[1]);A=G+M+F+H}if(m){var _=8+w+E+x,H=l(">L",[_]),z=40965,G=l(">H",[z]),M=l(">H",[y.Long]),F=l(">L",[1]);B=G+M+F+H}if(h){var _=8+w+E+x+$;k=l(">L",[_]);var O=_+S[0].length+24+4+S[1].length,W="\x02\x01\0\x04\0\0\0\x01"+l(">L",[O]),j="\x02\x02\0\x04\0\0\0\x01"+l(">L",[C.length]);L=S[0]+W+j+"\0\0\0\0"+S[1]+C}var q=b[0]+D+A+k+b[1];return g&&(P=u[0]+B+u[1]),"Exif\0\0MM\0*\0\0\0\b"+q+P+R+I+L},s.prototype={get_ifd:function(e,a){var i,o={},n=p(this.endian_mark+"H",this.tiftag.slice(e,e+2))[0],r=e+2;i=-1<["0th","1st"].indexOf(a)?"Image":a;for(var s=0;s<n;s++){e=r+12*s;var l=p(this.endian_mark+"H",this.tiftag.slice(e,e+2))[0],d=p(this.endian_mark+"H",this.tiftag.slice(e+2,e+4))[0],g=p(this.endian_mark+"L",this.tiftag.slice(e+4,e+8))[0],c=this.tiftag.slice(e+8,e+12);l in v[i]&&(o[l]=this.convert_value([d,g,c]))}return"0th"==a&&(e=r+12*n,o.first_ifd_pointer=this.tiftag.slice(e,e+4)),o},convert_value:function(e){var a,i=null,o=e[0],t=e[1],n=e[2];if(1==o)4<t?(a=p(this.endian_mark+"L",n)[0],i=p(this.endian_mark+d("B",t),this.tiftag.slice(a,a+t))):i=p(this.endian_mark+d("B",t),n.slice(0,t));else if(2==o)4<t?(a=p(this.endian_mark+"L",n)[0],i=this.tiftag.slice(a,a+t-1)):i=n.slice(0,t-1);else if(3==o)2<t?(a=p(this.endian_mark+"L",n)[0],i=p(this.endian_mark+d("H",t),this.tiftag.slice(a,a+2*t))):i=p(this.endian_mark+d("H",t),n.slice(0,2*t));else if(4==o)1<t?(a=p(this.endian_mark+"L",n)[0],i=p(this.endian_mark+d("L",t),this.tiftag.slice(a,a+4*t))):i=p(this.endian_mark+d("L",t),n);else if(5==o){if(a=p(this.endian_mark+"L",n)[0],1<t){i=[];for(var r=0;r<t;r++)i.push([p(this.endian_mark+"L",this.tiftag.slice(a+8*r,a+4+8*r))[0],p(this.endian_mark+"L",this.tiftag.slice(a+4+8*r,a+8+8*r))[0]])}else i=[p(this.endian_mark+"L",this.tiftag.slice(a,a+4))[0],p(this.endian_mark+"L",this.tiftag.slice(a+4,a+8))[0]];}else if(7==o)4<t?(a=p(this.endian_mark+"L",n)[0],i=this.tiftag.slice(a,a+t)):i=n.slice(0,t);else if(10!=o)throw"Exif might be wrong. Got incorrect value type to decode. type:"+o;else if(a=p(this.endian_mark+"L",n)[0],1<t){i=[];for(var r=0;r<t;r++)i.push([p(this.endian_mark+"l",this.tiftag.slice(a+8*r,a+4+8*r))[0],p(this.endian_mark+"l",this.tiftag.slice(a+4+8*r,a+8+8*r))[0]])}else i=[p(this.endian_mark+"l",this.tiftag.slice(a,a+4))[0],p(this.endian_mark+"l",this.tiftag.slice(a+4,a+8))[0]];return i instanceof Array&&1==i.length?i[0]:i}},"undefined"==typeof u)var u=function(e){for(var t,a,o,n,r,s,l,p="",d=0,g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";d<e.length;)t=e.charCodeAt(d++),a=e.charCodeAt(d++),o=e.charCodeAt(d++),n=t>>2,r=(3&t)<<4|a>>4,s=(15&a)<<2|o>>6,l=63&o,isNaN(a)?s=l=64:isNaN(o)&&(l=64),p=p+g.charAt(n)+g.charAt(r)+g.charAt(s)+g.charAt(l);return p};if("undefined"==typeof f)var f=function(e){var t,a,o,n,r,s,l,p="",d=0,g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");d<e.length;)n=g.indexOf(e.charAt(d++)),r=g.indexOf(e.charAt(d++)),s=g.indexOf(e.charAt(d++)),l=g.indexOf(e.charAt(d++)),t=n<<2|r>>4,a=(15&r)<<4|s>>2,o=(3&s)<<6|l,p+=String.fromCharCode(t),64!=s&&(p+=String.fromCharCode(a)),64!=l&&(p+=String.fromCharCode(o));return p};var y={Byte:1,Ascii:2,Short:3,Long:4,Rational:5,Undefined:7,SLong:9,SRational:10},v={Image:{11:{name:"ProcessingSoftware",type:"Ascii"},254:{name:"NewSubfileType",type:"Long"},255:{name:"SubfileType",type:"Short"},256:{name:"ImageWidth",type:"Long"},257:{name:"ImageLength",type:"Long"},258:{name:"BitsPerSample",type:"Short"},259:{name:"Compression",type:"Short"},262:{name:"PhotometricInterpretation",type:"Short"},263:{name:"Threshholding",type:"Short"},264:{name:"CellWidth",type:"Short"},265:{name:"CellLength",type:"Short"},266:{name:"FillOrder",type:"Short"},269:{name:"DocumentName",type:"Ascii"},270:{name:"ImageDescription",type:"Ascii"},271:{name:"Make",type:"Ascii"},272:{name:"Model",type:"Ascii"},273:{name:"StripOffsets",type:"Long"},274:{name:"Orientation",type:"Short"},277:{name:"SamplesPerPixel",type:"Short"},278:{name:"RowsPerStrip",type:"Long"},279:{name:"StripByteCounts",type:"Long"},282:{name:"XResolution",type:"Rational"},283:{name:"YResolution",type:"Rational"},284:{name:"PlanarConfiguration",type:"Short"},290:{name:"GrayResponseUnit",type:"Short"},291:{name:"GrayResponseCurve",type:"Short"},292:{name:"T4Options",type:"Long"},293:{name:"T6Options",type:"Long"},296:{name:"ResolutionUnit",type:"Short"},301:{name:"TransferFunction",type:"Short"},305:{name:"Software",type:"Ascii"},306:{name:"DateTime",type:"Ascii"},315:{name:"Artist",type:"Ascii"},316:{name:"HostComputer",type:"Ascii"},317:{name:"Predictor",type:"Short"},318:{name:"WhitePoint",type:"Rational"},319:{name:"PrimaryChromaticities",type:"Rational"},320:{name:"ColorMap",type:"Short"},321:{name:"HalftoneHints",type:"Short"},322:{name:"TileWidth",type:"Short"},323:{name:"TileLength",type:"Short"},324:{name:"TileOffsets",type:"Short"},325:{name:"TileByteCounts",type:"Short"},330:{name:"SubIFDs",type:"Long"},332:{name:"InkSet",type:"Short"},333:{name:"InkNames",type:"Ascii"},334:{name:"NumberOfInks",type:"Short"},336:{name:"DotRange",type:"Byte"},337:{name:"TargetPrinter",type:"Ascii"},338:{name:"ExtraSamples",type:"Short"},339:{name:"SampleFormat",type:"Short"},340:{name:"SMinSampleValue",type:"Short"},341:{name:"SMaxSampleValue",type:"Short"},342:{name:"TransferRange",type:"Short"},343:{name:"ClipPath",type:"Byte"},344:{name:"XClipPathUnits",type:"Long"},345:{name:"YClipPathUnits",type:"Long"},346:{name:"Indexed",type:"Short"},347:{name:"JPEGTables",type:"Undefined"},351:{name:"OPIProxy",type:"Short"},512:{name:"JPEGProc",type:"Long"},513:{name:"JPEGInterchangeFormat",type:"Long"},514:{name:"JPEGInterchangeFormatLength",type:"Long"},515:{name:"JPEGRestartInterval",type:"Short"},517:{name:"JPEGLosslessPredictors",type:"Short"},518:{name:"JPEGPointTransforms",type:"Short"},519:{name:"JPEGQTables",type:"Long"},520:{name:"JPEGDCTables",type:"Long"},521:{name:"JPEGACTables",type:"Long"},529:{name:"YCbCrCoefficients",type:"Rational"},530:{name:"YCbCrSubSampling",type:"Short"},531:{name:"YCbCrPositioning",type:"Short"},532:{name:"ReferenceBlackWhite",type:"Rational"},700:{name:"XMLPacket",type:"Byte"},18246:{name:"Rating",type:"Short"},18249:{name:"RatingPercent",type:"Short"},32781:{name:"ImageID",type:"Ascii"},33421:{name:"CFARepeatPatternDim",type:"Short"},33422:{name:"CFAPattern",type:"Byte"},33423:{name:"BatteryLevel",type:"Rational"},33432:{name:"Copyright",type:"Ascii"},33434:{name:"ExposureTime",type:"Rational"},34377:{name:"ImageResources",type:"Byte"},34665:{name:"ExifTag",type:"Long"},34675:{name:"InterColorProfile",type:"Undefined"},34853:{name:"GPSTag",type:"Long"},34857:{name:"Interlace",type:"Short"},34858:{name:"TimeZoneOffset",type:"Long"},34859:{name:"SelfTimerMode",type:"Short"},37387:{name:"FlashEnergy",type:"Rational"},37388:{name:"SpatialFrequencyResponse",type:"Undefined"},37389:{name:"Noise",type:"Undefined"},37390:{name:"FocalPlaneXResolution",type:"Rational"},37391:{name:"FocalPlaneYResolution",type:"Rational"},37392:{name:"FocalPlaneResolutionUnit",type:"Short"},37393:{name:"ImageNumber",type:"Long"},37394:{name:"SecurityClassification",type:"Ascii"},37395:{name:"ImageHistory",type:"Ascii"},37397:{name:"ExposureIndex",type:"Rational"},37398:{name:"TIFFEPStandardID",type:"Byte"},37399:{name:"SensingMethod",type:"Short"},40091:{name:"XPTitle",type:"Byte"},40092:{name:"XPComment",type:"Byte"},40093:{name:"XPAuthor",type:"Byte"},40094:{name:"XPKeywords",type:"Byte"},40095:{name:"XPSubject",type:"Byte"},50341:{name:"PrintImageMatching",type:"Undefined"},50706:{name:"DNGVersion",type:"Byte"},50707:{name:"DNGBackwardVersion",type:"Byte"},50708:{name:"UniqueCameraModel",type:"Ascii"},50709:{name:"LocalizedCameraModel",type:"Byte"},50710:{name:"CFAPlaneColor",type:"Byte"},50711:{name:"CFALayout",type:"Short"},50712:{name:"LinearizationTable",type:"Short"},50713:{name:"BlackLevelRepeatDim",type:"Short"},50714:{name:"BlackLevel",type:"Rational"},50715:{name:"BlackLevelDeltaH",type:"SRational"},50716:{name:"BlackLevelDeltaV",type:"SRational"},50717:{name:"WhiteLevel",type:"Short"},50718:{name:"DefaultScale",type:"Rational"},50719:{name:"DefaultCropOrigin",type:"Short"},50720:{name:"DefaultCropSize",type:"Short"},50721:{name:"ColorMatrix1",type:"SRational"},50722:{name:"ColorMatrix2",type:"SRational"},50723:{name:"CameraCalibration1",type:"SRational"},50724:{name:"CameraCalibration2",type:"SRational"},50725:{name:"ReductionMatrix1",type:"SRational"},50726:{name:"ReductionMatrix2",type:"SRational"},50727:{name:"AnalogBalance",type:"Rational"},50728:{name:"AsShotNeutral",type:"Short"},50729:{name:"AsShotWhiteXY",type:"Rational"},50730:{name:"BaselineExposure",type:"SRational"},50731:{name:"BaselineNoise",type:"Rational"},50732:{name:"BaselineSharpness",type:"Rational"},50733:{name:"BayerGreenSplit",type:"Long"},50734:{name:"LinearResponseLimit",type:"Rational"},50735:{name:"CameraSerialNumber",type:"Ascii"},50736:{name:"LensInfo",type:"Rational"},50737:{name:"ChromaBlurRadius",type:"Rational"},50738:{name:"AntiAliasStrength",type:"Rational"},50739:{name:"ShadowScale",type:"SRational"},50740:{name:"DNGPrivateData",type:"Byte"},50741:{name:"MakerNoteSafety",type:"Short"},50778:{name:"CalibrationIlluminant1",type:"Short"},50779:{name:"CalibrationIlluminant2",type:"Short"},50780:{name:"BestQualityScale",type:"Rational"},50781:{name:"RawDataUniqueID",type:"Byte"},50827:{name:"OriginalRawFileName",type:"Byte"},50828:{name:"OriginalRawFileData",type:"Undefined"},50829:{name:"ActiveArea",type:"Short"},50830:{name:"MaskedAreas",type:"Short"},50831:{name:"AsShotICCProfile",type:"Undefined"},50832:{name:"AsShotPreProfileMatrix",type:"SRational"},50833:{name:"CurrentICCProfile",type:"Undefined"},50834:{name:"CurrentPreProfileMatrix",type:"SRational"},50879:{name:"ColorimetricReference",type:"Short"},50931:{name:"CameraCalibrationSignature",type:"Byte"},50932:{name:"ProfileCalibrationSignature",type:"Byte"},50934:{name:"AsShotProfileName",type:"Byte"},50935:{name:"NoiseReductionApplied",type:"Rational"},50936:{name:"ProfileName",type:"Byte"},50937:{name:"ProfileHueSatMapDims",type:"Long"},50938:{name:"ProfileHueSatMapData1",type:"Float"},50939:{name:"ProfileHueSatMapData2",type:"Float"},50940:{name:"ProfileToneCurve",type:"Float"},50941:{name:"ProfileEmbedPolicy",type:"Long"},50942:{name:"ProfileCopyright",type:"Byte"},50964:{name:"ForwardMatrix1",type:"SRational"},50965:{name:"ForwardMatrix2",type:"SRational"},50966:{name:"PreviewApplicationName",type:"Byte"},50967:{name:"PreviewApplicationVersion",type:"Byte"},50968:{name:"PreviewSettingsName",type:"Byte"},50969:{name:"PreviewSettingsDigest",type:"Byte"},50970:{name:"PreviewColorSpace",type:"Long"},50971:{name:"PreviewDateTime",type:"Ascii"},50972:{name:"RawImageDigest",type:"Undefined"},50973:{name:"OriginalRawFileDigest",type:"Undefined"},50974:{name:"SubTileBlockSize",type:"Long"},50975:{name:"RowInterleaveFactor",type:"Long"},50981:{name:"ProfileLookTableDims",type:"Long"},50982:{name:"ProfileLookTableData",type:"Float"},51008:{name:"OpcodeList1",type:"Undefined"},51009:{name:"OpcodeList2",type:"Undefined"},51022:{name:"OpcodeList3",type:"Undefined"}},Exif:{33434:{name:"ExposureTime",type:"Rational"},33437:{name:"FNumber",type:"Rational"},34850:{name:"ExposureProgram",type:"Short"},34852:{name:"SpectralSensitivity",type:"Ascii"},34855:{name:"ISOSpeedRatings",type:"Short"},34856:{name:"OECF",type:"Undefined"},34864:{name:"SensitivityType",type:"Short"},34865:{name:"StandardOutputSensitivity",type:"Long"},34866:{name:"RecommendedExposureIndex",type:"Long"},34867:{name:"ISOSpeed",type:"Long"},34868:{name:"ISOSpeedLatitudeyyy",type:"Long"},34869:{name:"ISOSpeedLatitudezzz",type:"Long"},36864:{name:"ExifVersion",type:"Undefined"},36867:{name:"DateTimeOriginal",type:"Ascii"},36868:{name:"DateTimeDigitized",type:"Ascii"},37121:{name:"ComponentsConfiguration",type:"Undefined"},37122:{name:"CompressedBitsPerPixel",type:"Rational"},37377:{name:"ShutterSpeedValue",type:"SRational"},37378:{name:"ApertureValue",type:"Rational"},37379:{name:"BrightnessValue",type:"SRational"},37380:{name:"ExposureBiasValue",type:"SRational"},37381:{name:"MaxApertureValue",type:"Rational"},37382:{name:"SubjectDistance",type:"Rational"},37383:{name:"MeteringMode",type:"Short"},37384:{name:"LightSource",type:"Short"},37385:{name:"Flash",type:"Short"},37386:{name:"FocalLength",type:"Rational"},37396:{name:"SubjectArea",type:"Short"},37500:{name:"MakerNote",type:"Undefined"},37510:{name:"UserComment",type:"Ascii"},37520:{name:"SubSecTime",type:"Ascii"},37521:{name:"SubSecTimeOriginal",type:"Ascii"},37522:{name:"SubSecTimeDigitized",type:"Ascii"},40960:{name:"FlashpixVersion",type:"Undefined"},40961:{name:"ColorSpace",type:"Short"},40962:{name:"PixelXDimension",type:"Long"},40963:{name:"PixelYDimension",type:"Long"},40964:{name:"RelatedSoundFile",type:"Ascii"},40965:{name:"InteroperabilityTag",type:"Long"},41483:{name:"FlashEnergy",type:"Rational"},41484:{name:"SpatialFrequencyResponse",type:"Undefined"},41486:{name:"FocalPlaneXResolution",type:"Rational"},41487:{name:"FocalPlaneYResolution",type:"Rational"},41488:{name:"FocalPlaneResolutionUnit",type:"Short"},41492:{name:"SubjectLocation",type:"Short"},41493:{name:"ExposureIndex",type:"Rational"},41495:{name:"SensingMethod",type:"Short"},41728:{name:"FileSource",type:"Undefined"},41729:{name:"SceneType",type:"Undefined"},41730:{name:"CFAPattern",type:"Undefined"},41985:{name:"CustomRendered",type:"Short"},41986:{name:"ExposureMode",type:"Short"},41987:{name:"WhiteBalance",type:"Short"},41988:{name:"DigitalZoomRatio",type:"Rational"},41989:{name:"FocalLengthIn35mmFilm",type:"Short"},41990:{name:"SceneCaptureType",type:"Short"},41991:{name:"GainControl",type:"Short"},41992:{name:"Contrast",type:"Short"},41993:{name:"Saturation",type:"Short"},41994:{name:"Sharpness",type:"Short"},41995:{name:"DeviceSettingDescription",type:"Undefined"},41996:{name:"SubjectDistanceRange",type:"Short"},42016:{name:"ImageUniqueID",type:"Ascii"},42032:{name:"CameraOwnerName",type:"Ascii"},42033:{name:"BodySerialNumber",type:"Ascii"},42034:{name:"LensSpecification",type:"Rational"},42035:{name:"LensMake",type:"Ascii"},42036:{name:"LensModel",type:"Ascii"},42037:{name:"LensSerialNumber",type:"Ascii"},42240:{name:"Gamma",type:"Rational"}},GPS:{0:{name:"GPSVersionID",type:"Byte"},1:{name:"GPSLatitudeRef",type:"Ascii"},2:{name:"GPSLatitude",type:"Rational"},3:{name:"GPSLongitudeRef",type:"Ascii"},4:{name:"GPSLongitude",type:"Rational"},5:{name:"GPSAltitudeRef",type:"Byte"},6:{name:"GPSAltitude",type:"Rational"},7:{name:"GPSTimeStamp",type:"Rational"},8:{name:"GPSSatellites",type:"Ascii"},9:{name:"GPSStatus",type:"Ascii"},10:{name:"GPSMeasureMode",type:"Ascii"},11:{name:"GPSDOP",type:"Rational"},12:{name:"GPSSpeedRef",type:"Ascii"},13:{name:"GPSSpeed",type:"Rational"},14:{name:"GPSTrackRef",type:"Ascii"},15:{name:"GPSTrack",type:"Rational"},16:{name:"GPSImgDirectionRef",type:"Ascii"},17:{name:"GPSImgDirection",type:"Rational"},18:{name:"GPSMapDatum",type:"Ascii"},19:{name:"GPSDestLatitudeRef",type:"Ascii"},20:{name:"GPSDestLatitude",type:"Rational"},21:{name:"GPSDestLongitudeRef",type:"Ascii"},22:{name:"GPSDestLongitude",type:"Rational"},23:{name:"GPSDestBearingRef",type:"Ascii"},24:{name:"GPSDestBearing",type:"Rational"},25:{name:"GPSDestDistanceRef",type:"Ascii"},26:{name:"GPSDestDistance",type:"Rational"},27:{name:"GPSProcessingMethod",type:"Undefined"},28:{name:"GPSAreaInformation",type:"Undefined"},29:{name:"GPSDateStamp",type:"Ascii"},30:{name:"GPSDifferential",type:"Short"},31:{name:"GPSHPositioningError",type:"Rational"}},Interop:{1:{name:"InteroperabilityIndex",type:"Ascii"}}};v["0th"]=v.Image,v["1st"]=v.Image,h.TAGS=v,h.ImageIFD={ProcessingSoftware:11,NewSubfileType:254,SubfileType:255,ImageWidth:256,ImageLength:257,BitsPerSample:258,Compression:259,PhotometricInterpretation:262,Threshholding:263,CellWidth:264,CellLength:265,FillOrder:266,DocumentName:269,ImageDescription:270,Make:271,Model:272,StripOffsets:273,Orientation:274,SamplesPerPixel:277,RowsPerStrip:278,StripByteCounts:279,XResolution:282,YResolution:283,PlanarConfiguration:284,GrayResponseUnit:290,GrayResponseCurve:291,T4Options:292,T6Options:293,ResolutionUnit:296,TransferFunction:301,Software:305,DateTime:306,Artist:315,HostComputer:316,Predictor:317,WhitePoint:318,PrimaryChromaticities:319,ColorMap:320,HalftoneHints:321,TileWidth:322,TileLength:323,TileOffsets:324,TileByteCounts:325,SubIFDs:330,InkSet:332,InkNames:333,NumberOfInks:334,DotRange:336,TargetPrinter:337,ExtraSamples:338,SampleFormat:339,SMinSampleValue:340,SMaxSampleValue:341,TransferRange:342,ClipPath:343,XClipPathUnits:344,YClipPathUnits:345,Indexed:346,JPEGTables:347,OPIProxy:351,JPEGProc:512,JPEGInterchangeFormat:513,JPEGInterchangeFormatLength:514,JPEGRestartInterval:515,JPEGLosslessPredictors:517,JPEGPointTransforms:518,JPEGQTables:519,JPEGDCTables:520,JPEGACTables:521,YCbCrCoefficients:529,YCbCrSubSampling:530,YCbCrPositioning:531,ReferenceBlackWhite:532,XMLPacket:700,Rating:18246,RatingPercent:18249,ImageID:32781,CFARepeatPatternDim:33421,CFAPattern:33422,BatteryLevel:33423,Copyright:33432,ExposureTime:33434,ImageResources:34377,ExifTag:34665,InterColorProfile:34675,GPSTag:34853,Interlace:34857,TimeZoneOffset:34858,SelfTimerMode:34859,FlashEnergy:37387,SpatialFrequencyResponse:37388,Noise:37389,FocalPlaneXResolution:37390,FocalPlaneYResolution:37391,FocalPlaneResolutionUnit:37392,ImageNumber:37393,SecurityClassification:37394,ImageHistory:37395,ExposureIndex:37397,TIFFEPStandardID:37398,SensingMethod:37399,XPTitle:40091,XPComment:40092,XPAuthor:40093,XPKeywords:40094,XPSubject:40095,PrintImageMatching:50341,DNGVersion:50706,DNGBackwardVersion:50707,UniqueCameraModel:50708,LocalizedCameraModel:50709,CFAPlaneColor:50710,CFALayout:50711,LinearizationTable:50712,BlackLevelRepeatDim:50713,BlackLevel:50714,BlackLevelDeltaH:50715,BlackLevelDeltaV:50716,WhiteLevel:50717,DefaultScale:50718,DefaultCropOrigin:50719,DefaultCropSize:50720,ColorMatrix1:50721,ColorMatrix2:50722,CameraCalibration1:50723,CameraCalibration2:50724,ReductionMatrix1:50725,ReductionMatrix2:50726,AnalogBalance:50727,AsShotNeutral:50728,AsShotWhiteXY:50729,BaselineExposure:50730,BaselineNoise:50731,BaselineSharpness:50732,BayerGreenSplit:50733,LinearResponseLimit:50734,CameraSerialNumber:50735,LensInfo:50736,ChromaBlurRadius:50737,AntiAliasStrength:50738,ShadowScale:50739,DNGPrivateData:50740,MakerNoteSafety:50741,CalibrationIlluminant1:50778,CalibrationIlluminant2:50779,BestQualityScale:50780,RawDataUniqueID:50781,OriginalRawFileName:50827,OriginalRawFileData:50828,ActiveArea:50829,MaskedAreas:50830,AsShotICCProfile:50831,AsShotPreProfileMatrix:50832,CurrentICCProfile:50833,CurrentPreProfileMatrix:50834,ColorimetricReference:50879,CameraCalibrationSignature:50931,ProfileCalibrationSignature:50932,AsShotProfileName:50934,NoiseReductionApplied:50935,ProfileName:50936,ProfileHueSatMapDims:50937,ProfileHueSatMapData1:50938,ProfileHueSatMapData2:50939,ProfileToneCurve:50940,ProfileEmbedPolicy:50941,ProfileCopyright:50942,ForwardMatrix1:50964,ForwardMatrix2:50965,PreviewApplicationName:50966,PreviewApplicationVersion:50967,PreviewSettingsName:50968,PreviewSettingsDigest:50969,PreviewColorSpace:50970,PreviewDateTime:50971,RawImageDigest:50972,OriginalRawFileDigest:50973,SubTileBlockSize:50974,RowInterleaveFactor:50975,ProfileLookTableDims:50981,ProfileLookTableData:50982,OpcodeList1:51008,OpcodeList2:51009,OpcodeList3:51022,NoiseProfile:51041},h.ExifIFD={ExposureTime:33434,FNumber:33437,ExposureProgram:34850,SpectralSensitivity:34852,ISOSpeedRatings:34855,OECF:34856,SensitivityType:34864,StandardOutputSensitivity:34865,RecommendedExposureIndex:34866,ISOSpeed:34867,ISOSpeedLatitudeyyy:34868,ISOSpeedLatitudezzz:34869,ExifVersion:36864,DateTimeOriginal:36867,DateTimeDigitized:36868,ComponentsConfiguration:37121,CompressedBitsPerPixel:37122,ShutterSpeedValue:37377,ApertureValue:37378,BrightnessValue:37379,ExposureBiasValue:37380,MaxApertureValue:37381,SubjectDistance:37382,MeteringMode:37383,LightSource:37384,Flash:37385,FocalLength:37386,SubjectArea:37396,MakerNote:37500,UserComment:37510,SubSecTime:37520,SubSecTimeOriginal:37521,SubSecTimeDigitized:37522,FlashpixVersion:40960,ColorSpace:40961,PixelXDimension:40962,PixelYDimension:40963,RelatedSoundFile:40964,InteroperabilityTag:40965,FlashEnergy:41483,SpatialFrequencyResponse:41484,FocalPlaneXResolution:41486,FocalPlaneYResolution:41487,FocalPlaneResolutionUnit:41488,SubjectLocation:41492,ExposureIndex:41493,SensingMethod:41495,FileSource:41728,SceneType:41729,CFAPattern:41730,CustomRendered:41985,ExposureMode:41986,WhiteBalance:41987,DigitalZoomRatio:41988,FocalLengthIn35mmFilm:41989,SceneCaptureType:41990,GainControl:41991,Contrast:41992,Saturation:41993,Sharpness:41994,DeviceSettingDescription:41995,SubjectDistanceRange:41996,ImageUniqueID:42016,CameraOwnerName:42032,BodySerialNumber:42033,LensSpecification:42034,LensMake:42035,LensModel:42036,LensSerialNumber:42037,Gamma:42240},h.GPSIFD={GPSVersionID:0,GPSLatitudeRef:1,GPSLatitude:2,GPSLongitudeRef:3,GPSLongitude:4,GPSAltitudeRef:5,GPSAltitude:6,GPSTimeStamp:7,GPSSatellites:8,GPSStatus:9,GPSMeasureMode:10,GPSDOP:11,GPSSpeedRef:12,GPSSpeed:13,GPSTrackRef:14,GPSTrack:15,GPSImgDirectionRef:16,GPSImgDirection:17,GPSMapDatum:18,GPSDestLatitudeRef:19,GPSDestLatitude:20,GPSDestLongitudeRef:21,GPSDestLongitude:22,GPSDestBearingRef:23,GPSDestBearing:24,GPSDestDistanceRef:25,GPSDestDistance:26,GPSProcessingMethod:27,GPSAreaInformation:28,GPSDateStamp:29,GPSDifferential:30,GPSHPositioningError:31},h.InteropIFD={InteroperabilityIndex:1},"undefined"==typeof exports?window.piexif=h:("undefined"!=typeof module&&module.exports&&(exports=module.exports=h),exports.piexif=h)})();var ImagerJs={plugins:{},util:{},translations:{}};modules.push(function({$:e,namespace:t}){var a=null,i=e("<div class=\"modaljs-overlay hidden hidden-add-end noselect\"></div>"),o=e("<div class=\"modaljs-wrapper hidden noselect\"><div class=\"modaljs-wrapper2 modaljs-modals-container noselect\"></div></div>");a=e("body"),a.append(i),a.append(o);var n=function(){var t=this,a=e("<div class=\"modaljs hidden noselect\"><header></header><div class=\"modaljs-template-container noselect\"></div><footer></footer>");o.find(".modaljs-modals-container").append(a),o.find(".modaljs").scroll(function(){e(window).trigger("resize")}),this.$modal=a,this.classname="",this.cancelHandler=null,e(window).resize(function(){t.fixPosition()}),e("body").on("imagerResize",function(){t.fixPosition()})};n.prototype.setTitle=function(e){this.$modal.find("header").html(e)},n.prototype.setTemplate=function(t){this.$modal.find(".modaljs-template-container").append(e(t))},n.prototype.fixPosition=function(){if(!(1>o.find(".modaljs").length)){var t=o.find(".modaljs > header")[0].getBoundingClientRect().height,a=o.find(".modaljs > .modaljs-template-container")[0].getBoundingClientRect().height,i=o.find(".modaljs > footer")[0].getBoundingClientRect().height;e(window).height()<=t+a+i?o.addClass("fullheight"):o.removeClass("fullheight")}},n.prototype.addCancelButton=function(t,a){var i=this;i.cancelHandler=a;var o=e("<button></button>").text(t);o.on("click",function(){i.hide(),i.cancelHandler&&i.cancelHandler()}),i.$modal.find("footer").append(o),i._fixButtonsSize()},n.prototype.addClass=function(e){this.classname+=" "+e,this.$modal.addClass(e)},n.prototype.addActionButton=function(t,a){var i=this,o=e("<button></button>").addClass("modaljs-action-button").text(t);o.on("click",function(){var e=a();e===void 0&&!1!==e&&i.hide()}),i.$modal.find("footer").append(o),i._fixButtonsSize()},n.prototype._fixButtonsSize=function(){var e=this.$modal.find("footer button");e.css("width",100/e.length+"%")},n.prototype.show=function(){var t=this;i.addClass(this.classname),i.removeClass("hidden-add-end"),i.removeClass("hidden"),i.css("height",e("body").height()),i.on("click",function(){t.hide(),t.cancelHandler&&t.cancelHandler()}),o.removeClass("hidden"),this.$modal.removeClass("hidden");var n=a.width();this.overflowBefore=a.css("overflow"),a.css("overflow","hidden"),this.widthDiff=a.width()-n,this.paddingBefore=a.css("padding-right"),a.css("padding-right",this.widthDiff+"px")},n.prototype.hide=function(){i.removeClass(this.classname),i.addClass("hidden"),setTimeout(function(){i.addClass("hidden-add-end")},400),i.off("click"),o.addClass("hidden"),this.$modal.addClass("hidden"),a.css("overflow",this.overflowBefore),a.css("padding-right",this.paddingBefore)},n.prototype.remove=function(){this.$modal.remove(),this.cancelHandler=!1},t.Modal=n}),modules.push(function({$:e,namespace:t,util:a}){var i=function(t){var a=this;t=t||{};a.options=e.extend({tooltipEnabled:!0,tooltipCss:null},t),a.$toolbar=e("<ul class=\"toolbar\"></ul>").attr("contenteditable","false").addClass("noselect").addClass("toolbar-topLeft"),a.tooltips=[],a.buttonsGroups={}};i.prototype.getElement=function(){return this.$toolbar},i.prototype.addButton=function(e,t,a,i){var o=this.createButton(e,t,i);return this.$toolbar.append(o),this.createTooltip(o.find("a"),e,a,"bottom"),o},i.prototype.createButton=function(t,i,o){var n=this,r=e("<li data-sizeable=\"toolbar-button\" data-cssrules=\"width,height\"><a href=\"#\" data-sizeable=\"toolbar-button\" data-cssrules=\"line-height,font-size:($v / 2.5)\" tabindex=\"-1\"><i class=\"fa "+i+"\"></i></a></li>").addClass(t);return a.bindClick(r.find("a"),"imager-button",function(){return o(n)}),r},i.prototype.addButtonToGroup=function(t,i,o,n,r){var s=null;this.buttonsGroups[n.name]||(s=e("<li class=\"btn-group\" data-editable-canvas-sizeable=\"toolbar-button\" data-editable-canvas-cssrules=\"width,height\"><a href=\"#\" data-editable-canvas-sizeable=\"toolbar-button\" data-editable-canvas-cssrules=\"line-height,font-size:($v / 2.5)\" tabindex=\"-1\"><i class=\"fa "+i+"\"></i></a><ul class=\"group-items-container hidden\"></ul></li>"),this.buttonsGroups[n.name]=s,this.$toolbar.append(s),a.bindClick(s.children("a"),"drawer-toolbar-group-button",function(){s.find("ul.group-items-container").toggleClass("hidden")}),this.createTooltip(s.children("a"),n.name,n.tooltip,"bottom")),s=this.buttonsGroups[n.name];var l=this.createButton(t,i,function(e){s.find("ul.group-items-container").toggleClass("hidden"),r(e),s.attr("class",l.attr("class")).addClass("btn-group"),s.children("a").attr("class",l.children("a").attr("class")),s.children("a").html(l.children("a").html())});return s.find(".group-items-container").append(l),this.createTooltip(l.find("a"),t+" group-item",o,"right"),l},i.prototype.createTooltip=function(t,a,i,o){if(this.options.tooltipEnabled){var n=e("<span>").addClass("toolbar-tooltip tooltip-"+a).html(i);n.appendTo("body"),this.tooltips.push(n),this.options.tooltipCss&&n.css(this.options.tooltipCss),t.on("mouseenter",function(){if(!e(this).hasClass("disabled")){var a=t.offset(),i=t.innerHeight(),r=t.innerWidth();n.addClass("active");var s=0,l=0;"right"===o?(s=a.top+(t.height()-n.outerHeight())/2,l=a.left+r):(s=a.top+i,l=a.left+r/2-n.innerWidth()/2),n.css({top:s+"px",left:l+"px"})}}),t.on("mouseout",function(){n.removeClass("active")})}},i.prototype.setActiveButton=function(e){this.$toolbar.find("li."+e).children("a").addClass("active")},i.prototype.clearActiveButton=function(){this.$toolbar.find("li").children("a").removeClass("active")},i.prototype.remove=function(){this.$toolbar&&(this.$toolbar.remove(),this.$toolbar=null),this.tooltips&&(this.tooltips.map(function(e){return e.remove(),e=null,null}),this.tooltips=null)},t.Toolbar=i}),modules.push(function({$:e,translations:t,namespace:a}){var i=function(a,i){var o=this;o.defaultOptions={sizes:[{label:"Original",scale:1,quality:1,percentage:100},{label:"Large",scale:.5,quality:.5,percentage:50},{label:"Medium",scale:.2,quality:.2,percentage:20},{label:"Small",scale:.05,quality:.05,percentage:5}],allowCustomSetting:!0},i=i?i:{},o.options=e.extend(!0,o.defaultOptions,i),o.options.allowCustomSetting&&o.options.sizes.push({label:"Custom"}),o.imager=a,o.$qualitySelector=e("<div class=\"imager-quality-wrapper\"><form><div class=\"imager-quality-container form-group\"><label for=\"imager-quality\">"+t.t("Quality")+"</label><select id=\"imager-quality\" class=\"form-control\"></select></div></form><form class=\"form-inline custom-quality hidden\"><div class=\"form-group\"><label for=\"imager-quality-custom\" class=\"imager-quality-custom\">"+t.t("Custom quality percent")+"</label><div class=\"input-group\"><input id=\"imager-quality-custom\" type=\"number\" min=\"1\" max=\"100\"class=\"form-control imager-quality-custom\" value=\"100\"/><div class=\"input-group-addon\">%</div><div class=\"size-in-kb\"></div></div></div></form></div>").addClass("hidden"),o.$qualitySelector.find("input.imager-quality-custom").change(function(){var a=parseInt(e(this).val());o.imager.quality=a/100,o.imager.targetScale=a/100,o.imager.render();var i=o.imager.getDataSize()/1024,n=Math.round(i)+" "+t.t("KB");o.$qualitySelector.find(".size-in-kb").text(n)}),o.$qualitySelector.find("select").on("change",function(){var t=parseInt(e(this).val()),a=o.options.sizes[t];(null===a||a===void 0)&&(a=o.options.sizes[0]),"Custom"==a.label?(o.$qualitySelector.find("form.custom-quality").removeClass("hidden"),o.$qualitySelector.addClass("custom-quality-visible"),o.imager.$imageElement.addClass("custom-quality-visible")):(o.$qualitySelector.find("form.custom-quality").addClass("hidden"),o.$qualitySelector.removeClass("custom-quality-visible"),o.imager.$imageElement.removeClass("custom-quality-visible")),e("body").trigger("imagerResize"),o.imager.adjustEditContainer(),o.imager.quality=a.quality?a.quality:.5,o.imager.targetScale=a.scale?a.scale:.5,o.imager.render()})};i.prototype.getElement=function(){return this.$qualitySelector},i.prototype.update=function(){var a=this.$qualitySelector.find("option:selected").val();this.$qualitySelector.find("option").remove();for(var o=0;o<this.options.sizes.length;o++){var n=this.options.sizes[o],r=t.t(n.label);if(n.percentage!==void 0){this.imager.quality=n.quality,this.imager.targetScale=n.scale,this.imager.render();var s=this.imager.getDataSize()/1024;r+=" - "+Math.round(s)+" "+t.t("KB")+" ("+n.percentage+"%)"}var l=e("<option value=\""+o+"\">"+r+"</option>");this.$qualitySelector.find("select").append(l)}a?this.$qualitySelector.find("select").val(a):this.$qualitySelector.find("select").val(0),this.$qualitySelector.find("select").trigger("change")},i.prototype.val=function(){this.$qualitySelector.find("select").val.apply(this.$qualitySelector,arguments)},i.prototype.show=function(){this.$qualitySelector.removeClass("hidden")},i.prototype.hide=function(){this.$qualitySelector.addClass("hidden")},a.ImagerQualitySelector=i}),modules.push(function({$:e,translations:t}){t.set=function(a){a=a?a:{},t.translations=e.extend(!0,t.translations,a)},t.translations={"Incorrect file type":"Incorrect file type",Insert:"Insert",Cancel:"Cancel","Add image":"Add image",Quality:"Quality",Rotate:"Rotate",Crop:"Crop",Original:"Original",KB:"KB",Large:"Large",Medium:"Medium",Small:"Small","Custom quality percent":"Custom quality percent",Custom:"Custom","Image properties":"Image properties","Size:":"Size:","width in px":"width in px","height in px":"height in px",Left:"Left",Right:"Right",Center:"Center",Inline:"Inline",Floating:"Floating","Transparent background":"Transparent background",Apply:"Apply",Reject:"Reject","Delete image":"Delete image","Move image":"Move image","Are you sure want to delete this image?":"Are you sure want to delete this image?","Or drop files here":"Or drop files here","No file selected.":"No file selected.","Please wait...":"Please wait...",Save:"Save",Undo:"Undo","Rotate manually":"Rotate manually","Rotate 90 left":"Rotate 90\xB0 left","Rotate 90 right":"Rotate 90\xB0 left","Image is too big and could cause very poor performance.":"Image is too big and could cause very poor performance."},t.t=function(e){return t.translations[e]?t.translations[e]:(console.warn("String not found in texts:"+e),e)}}),modules.push(function({$:e,namespace:t,pluginsCatalog:a,util:i,translations:o}){var n=[],r={ios:"ios",android:"android",windowsMobile:"windowsMobile",genericMobile:"genericMobile"},s=function(t,i){var o=this;o.$imageElement=e(t),o.defaultOptions={saveData:void 0,loadData:void 0,quality:1,targetScale:1,plugins:[],format:void 0,toolbarButtonSize:32,toolbarButtonSizeTouch:50,editModeCss:{border:"1px solid white"},pluginsConfig:{},detectTouch:null,waitingCursor:"wait",imageSizeForPerformanceWarning:1e6,maxImageWidth:2048,maxImageHeight:2048},i=i?i:{},o.options=e.extend(!0,o.defaultOptions,i),o.debug=!1,o.showTemporaryCanvas=!1,o.targetScale=o.options.targetScale,o.quality=o.options.quality,o._eventEmitter=e({}),o._isInEditMode=!1,o.history=[],n.push(o),o.originalExif=null,this.detectPlatform(),this.options.canvasSizeLimit||(-1===[r.ios,r.android,r.windowsMobile].indexOf(o.platform)?this.canvasSizeLimit=33554432:this.canvasSizeLimit=5242880),o.$originalImage=o.$imageElement.clone(),o.handleImageElementSrcChanged(),o.pluginsInstances=null,o.instantiatePlugins(a),e("body").on("imagerResize",function(){o.adjustEditContainer()}),e(window).on("resize",function(){o.adjustEditContainer()})};s.prototype.on=function(e,t){this._eventEmitter.on(e,t)},s.prototype.off=function(e){this._eventEmitter.off(e)},s.prototype.trigger=function(e,t){this._eventEmitter.trigger(e,t);for(var a,o="on"+e.substr(0,1).toUpperCase()+e.substr(1),n=0;n<this.pluginsInstances.length;n++)a=this.pluginsInstances[n],void 0!==a[o]&&a[o](t)},s.prototype.log=function(){if(this.debug){var e=Array.prototype.slice.call(arguments);console.log.apply(console,e)}},s.prototype.invokePluginsMethod=function(e){var t=[],a=Array.prototype.slice.call(arguments);a=a.slice(1);for(var o,n=0;n<this.pluginsInstances.length;n++)if(o=this.pluginsInstances[n],void 0!==o[e]){var r=o[e].apply(o,a);r&&t.push({name:o.__name,instance:o,result:r})}return t},s.prototype.pluginSort=function(e,t){return(void 0===e.weight||null===t.weight)&&(e.weight=1/0),(void 0===t.weight||null===t.weight)&&(t.weight=1/0),e.weight<t.weight?-1:e.weight>t.weight?1:0},s.prototype.instantiatePlugins=function(e){for(var t in this.pluginsInstances=[],e)if(-1<this.options.plugins.indexOf(t)&&e.hasOwnProperty(t)){var a=new e[t](this,this.options.pluginsConfig[t]);a.__name=t,this.pluginsInstances.push(a)}this.pluginsInstances.sort(this.pluginSort)},s.prototype.getPluginInstance=function(e){for(var t,a=0;a<this.pluginsInstances.length;a++)if(t=this.pluginsInstances[a],t.__name==e)return t},s.prototype.handleImageElementSrcChanged=function(){var e=this;if(e.options.format||(e.options.format=e.getImageFormat(e.$imageElement.attr("src"))),!e.$imageElement.attr("data-imager-id"))e.id=i.uuid(),e.$imageElement.attr("data-imager-id",e.id);else if(e.id=e.$imageElement.attr("data-imager-id"),1>e.$imageElement.attr("src").length)throw new Error("Imager was initialized on an empty image. Please check image's `src` attribute. It should not be empty.");e.fixImageSizeAndRotation(e.$imageElement).then(function(t){e.$imageElement.attr("src",t),e.$imageElement.attr("imager-attached",!0)}).fail(function(e){console.error(e)}),e.$imageElement.on("load.imagerInit",function(){e.$imageElement.off("load.imagerInit"),e.trigger("ready")})},s.prototype.fixImageSizeAndRotation=function(t){var a=this,i=e.Deferred(),o=t.attr("src");if(1>o.length)return e.when("");if(0===o.indexOf("data:image"))return this._fixBase64ImageSizeAndRotation(o);if(0===o.indexOf("http")){var n=new XMLHttpRequest;return n.responseType="blob",n.onload=function(){var e=new FileReader;e.onloadend=function(){a._fixBase64ImageSizeAndRotation(e.result).then(function(e){i.resolve(e)})},e.onerror=function(e){i.reject(e)},e.readAsDataURL(n.response)},n.open("GET",o),n.send(),i.promise()}return console.error("Unsupported image `src`!"),e.when("")},s.prototype._fixBase64ImageSizeAndRotation=function(t){var a=this,o=e.Deferred(),n=a.getImageFormat(a.$imageElement.attr("src"));if("jpeg"===n||"jpg"===n){this.originalExif=piexif.load(t);var r=this.originalExif["0th"][piexif.ImageIFD.Orientation];this.originalExif["0th"][piexif.ImageIFD.Orientation]=1,t=piexif.insert(piexif.dump(this.originalExif),t)}var s=document.createElement("img");return s.onload=function(){var e=document.createElement("canvas");e.width=s.naturalWidth,e.height=s.naturalHeight;var t=e.getContext("2d");if(("jpeg"===n||"jpg"===n)&&(2===r?(t.translate(e.width,0),t.scale(-1,1)):3===r?(t.translate(e.width,e.height),t.rotate(Math.PI)):4===r?(t.translate(0,e.height),t.scale(1,-1)):5===r?(e.width=s.naturalHeight,e.height=s.naturalWidth,t.rotate(.5*Math.PI),t.scale(1,-1)):6===r?(e.width=s.naturalHeight,e.height=s.naturalWidth,t.translate(e.width,0),t.rotate(.5*Math.PI)):7===r?(e.width=s.naturalHeight,e.height=s.naturalWidth,t.rotate(.5*Math.PI),t.translate(e.width,-e.height),t.scale(-1,1)):8===r?(e.width=s.naturalHeight,e.height=s.naturalWidth,t.rotate(-.5*Math.PI),t.translate(-e.width,0)):void 0),t.drawImage(s,0,0),e.width>a.options.maxImageWidth){var l=a.options.maxImageWidth,p=100*a.options.maxImageWidth/e.width,d=p*e.height/100;a.log("Image is bigger than we could handle, resizing to",l,d),i.resizeImage(e,e.width,e.height,l,d)}o.resolve(e.toDataURL(a.options.format))},s.src=t,o.promise()},s.prototype.startSelector=function(){var t=this;this.$selectorContainer=e("<div class=\"imager-selector-container\" tabindex=\"1\"></div>");var a=function(){t.off("ready",a),t.startEditing(),t.$selectorContainer.remove(),t.$selectorContainer=null},n=function(){t.$imageElement.off("load",n),t.handleImageElementSrcChanged(),t.on("ready",a)},r=new i.FileSelector("image/*");r.onFileSelected(function(e){i.setWaiting(t.$selectorContainer,o.t("Please wait...")),setTimeout(function(){t.$imageElement.attr("src",e.data),t.$imageElement.css("height","auto"),t.$imageElement.css("min-height","inherit"),t.$imageElement.css("min-width","inherit"),t.$imageElement.on("load",n)},200)}),this.$selectorContainer.append(r.getElement()),e("body").append(this.$selectorContainer);var s=this.$imageElement.offset();this.$selectorContainer.css({left:s.left,top:s.top,width:this.$imageElement.width(),height:this.$imageElement.height()})},s.prototype.startEditing=function(){if(this.log("startEditing()"),this.hideOriginalImage(),!this.$imageElement[0].complete)throw new Error("Trying to start editing image that was not yet loaded. Please add `ready` event listener to imager.");this.originalPreviewWidth=this.$imageElement.width(),this.originalPreviewHeight=this.$imageElement.height(),this.$editContainer=e("<div class=\"imager-edit-container\" tabindex=\"1\"></div>"),this.options.editModeCss&&this.$editContainer.css(this.options.editModeCss),e("body").append(this.$editContainer),this._createEditCanvas(),this.adjustEditContainer(),this.trigger("editStart"),this.render(),this._isInEditMode=!0,this.$editContainer.focus();var t=this.getDataSize();t>this.options.imageSizeForPerformanceWarning&&i.setOverlayMessage(this.$editContainer,"Image is too big and could cause very poor performance.","default","Ok",function(){i.removeOverlayMessage(this.$editContainer)}.bind(this)),this._adjustElementsSize("toolbar-button",this.touchDevice?this.options.toolbarButtonSizeTouch:this.options.toolbarButtonSize),0===this.history.length&&this.commitChanges("Original"),this.trigger("historyChange")},s.prototype.stopEditing=function(){if(this._isInEditMode){this.showOriginalImage(),this.render();var t=this.invokePluginsMethod("serialize"),a={};e(t).each(function(e,t){a[t.name]=t.result});var i=null;try{i=this.canvas.toDataURL("image/"+this.options.format,this.quality)}catch(e){e.name&&"SecurityError"===e.name?console.error("Failed to get image data from canvas because of security error.Usually this happens when image drawed on canvas is located on separate domain withoutproper access-control headers."):console.error(e)}i||console.error("Failed to get image data from canvas."),this.$imageElement.attr("src",i),this.$editContainer.remove(),this.$editContainer=null,this.canvas=null,this.tempCanvas=null,this.trigger("editStop",{imageData:i,pluginsData:a}),this._isInEditMode=!1}},s.prototype.setZindex=function(e){this.$editContainer&&this.$editContainer.css("z-index",e)},s.prototype.commitChanges=function(e,t){function a(){i.$imageElement.off("load",a),i.quality=o,i.targetScale=n,i.adjustCanvasSize(),i.history.push({message:e,image:r,width:i.$imageElement.width(),height:i.$imageElement.height()}),i.originalPreviewWidth=i.$imageElement.width(),i.originalPreviewHeight=i.$imageElement.height(),i.render(),i.trigger("historyChange"),t&&t instanceof Function&&t()}var i=this,o=this.quality,n=this.targetScale;this.quality=1,this.targetScale=1,this.adjustCanvasSize(),this.render();var r=this.canvas.toDataURL("image/"+this.options.format,100);this.$imageElement.on("load",a),this.$imageElement.on("error",function(e){console.warn("commitChanges() : image failed to load :",e),console.trace()}),this.$imageElement.attr("src",r)},s.prototype.isInEditMode=function(){return this._isInEditMode},s.prototype._createEditCanvas=function(){var t=this.$imageElement.width(),a=this.$imageElement.height(),i=this.$imageElement[0].naturalWidth,o=this.$imageElement[0].naturalHeight,n=e("<canvas class=\"imager-edit-canvas\"/>");n.css({width:t,height:a}),this.canvas=n[0],this.adjustCanvasSize(),this.$editContainer.append(n),this.tempCanvas=document.createElement("canvas"),this.tempCanvas.width=i,this.tempCanvas.height=o,this.showTemporaryCanvas&&(e("body").append(this.tempCanvas),e(this.tempCanvas).css({position:"absolute",left:"50px",top:"50px",width:t}))},s.prototype.render=function(e){e=e===void 0?this.canvas.getContext("2d"):e;var t=this.$imageElement[0].naturalWidth,a=this.$imageElement[0].naturalHeight;if(0===t||0===a)return console.warn("Trying to render canvas with zero width or height"),void console.trace();e.canvas.width=t*this.targetScale,e.canvas.height=a*this.targetScale,this.tempCanvas.width=t,this.tempCanvas.height=a;var i=e.canvas.width,o=e.canvas.height;this.drawImage(this.$imageElement,e,{sourceLeft:0,sourceTop:0,sourceWidth:t,sourceHeight:a,destLeft:0,destTop:0,destWidth:i,destHeight:o,paddingWidth:0,paddingHeight:0}),this.invokePluginsMethod("render",e)},s.prototype.clearCanvas=function(e){e.clearRect(0,0,e.canvas.width,e.canvas.height),"jpeg"==this.options.format&&(e.fillStyle="#FFFFFF",e.fillRect(0,0,e.canvas.width,e.canvas.height))},s.prototype.drawImage=function(e,t,a){return 0===t.canvas.width||0===t.canvas.height?void console.warn("Imager.drawImage() : Trying to render canvas with either width or height equal to 0"):void this._drawWithScaling(e,t,this.tempCanvas.getContext("2d"),a.sourceLeft,a.sourceTop,a.sourceWidth,a.sourceHeight,a.destLeft,a.destTop,a.destWidth,a.destHeight,a.paddingWidth,a.paddingHeight)},s.prototype._drawWithScaling=function(e,t,a,i,o,n,r,l,p,d,g,c,m){c=c===void 0?0:c,m=m===void 0?0:m,i=i===void 0?0:i,o=o===void 0?0:o;var h=c/2,u=m/2,f=a.canvas;a.clearRect(0,0,n,r);var y=e[0],v=.5,S=n,C=r,b=i,w=o;a.drawImage(y,b,w,n,r,0,0,S,C);for(var P=0;P<3&&!(S<=2*d||C<=2*g);P++){var E=S,R=C;S*=v,C*=v,b*=v,w*=v;var x=document.createElement("canvas");x.width=a.canvas.width,x.height=a.canvas.height;var I=x.getContext("2d");I.clearRect(0,0,x.width,x.height),I.drawImage(f,b,w,E,R,0,0,S,C),a.clearRect(0,0,a.canvas.width,a.canvas.height),a.drawImage(x,0,0,S,C,0,0,S,C)}t.clearRect(0,0,t.canvas.width,t.canvas.height),t.drawImage(f,0,0,S,C,l+h,p+u,d-c,g-m)},s.prototype.setPreviewSize=function(t,a){this.$imageElement.css({width:t,height:a}),e(this.canvas).css({width:t,height:a}),e("body").trigger("imagerResize"),this.log("resize trigger"),this.originalPreviewWidth=this.$imageElement.width(),this.originalPreviewHeight=this.$imageElement.height()},s.prototype.getPreviewSize=function(){return{width:this.$imageElement.width(),height:this.$imageElement.height()}},s.prototype.getImageRealSize=function(){return{width:this.$imageElement[0].naturalWidth,height:this.$imageElement[0].naturalHeight}},s.prototype.getCanvasSize=function(){return{width:this.canvas.width,height:this.canvas.height}},s.prototype.convertScale=function(e,t,a){return 100*e/t*a/100},s.prototype.hideOriginalImage=function(){this.$imageElement.css("opacity",0)},s.prototype.showOriginalImage=function(){this.$imageElement.css("opacity",1)},s.prototype.adjustCanvasSize=function(){var e=this.getImageRealSize(),t=this.getPreviewSize(),a=0,i=0,o=0;if(t.width>t.height?(a=e.width,o=100*t.height/t.width,i=o*a/100):(i=e.height,o=100*t.width/t.height,a=o*i/100),this.canvas.width=a*this.targetScale,this.canvas.height=i*this.targetScale,this.canvasSizeLimit=1048576,this.canvasSizeLimit&&this.canvas.width*this.canvas.height>this.canvasSizeLimit){console.warn("adjustCanvasSize(): canvas size is too big : ",this.canvas.width,this.canvas.height);var n=.95*this.canvasSizeLimit/(this.canvas.width*this.canvas.height);this.canvas.width*=n,this.canvas.height*=n,console.warn("adjustCanvasSize(): canvas was reduced to : ",this.canvas.width,this.canvas.height)}},s.prototype.adjustEditContainer=function(){var e=this,t=e.$imageElement.offset();e.$editContainer&&e.$editContainer.css({left:t.left,top:t.top,width:e.$imageElement.width(),height:e.$imageElement.height()}),e.$selectorContainer&&e.$selectorContainer.css({left:t.left,top:t.top,width:this.$imageElement.width(),height:this.$imageElement.attr("src")?this.$imageElement.height():"auto"})},s.prototype.restoreOriginal=function(){this.$imageElement.replaceWith(this.$originalImage)},s.prototype.historyUndo=function(){function e(){t.$imageElement.off("load",e),t.originalPreviewWidth=t.$imageElement.width(),t.originalPreviewHeight=t.$imageElement.height(),t.setPreviewSize(a.width,a.height),t.render(),t.history.splice(t.history.length-1,1),t.trigger("historyChange")}if(!(2>this.history.length)){var t=this,a=this.history[this.history.length-2];this.$imageElement.on("load",e),this.$imageElement.attr("src",a.image),this.$imageElement.width(a.width),this.$imageElement.height(a.height)}},s.prototype.remove=function(e){this.trigger("remove"),this.$imageElement.removeAttr("imager-attached"),this.stopEditing(),this.showOriginalImage();var t=n.indexOf(this);n.splice(t,1),this.$originalImage=null,this.pluginsInstances=null,e&&this.$imageElement.remove()},s.prototype.getDataSize=function(){var e="data:image/"+this.options.format+";base64,",t=this.canvas.toDataURL("image/"+this.options.format,this.quality),a=Math.round(3*(t.length-e.length)/4);return a},s.getImagerFor=function(t){for(var a,o=0;o<n.length;o++)if(a=n[o],a.id==e(t).attr("data-imager-id"))return a},s.isImagerAttached=function(t){return e(t).attr("imager-attached")!==void 0},s.prototype.setWaiting=function(e){e?this.$editContainer&&i.setWaiting(this.$editContainer,o.t("Please wait..."),this.options.waitingCursor):i.stopWaiting(this.$editContainer)},s.prototype.getImageFormat=function(e){if(e){var t;return 0===e.indexOf("http")?(t=e.split(".").pop(),"jpeg"==t?t="jpeg":"jpg"==t?t="jpeg":"png"==t&&(t="png")):0===e.indexOf("data:image")&&("j"==e[11]?t="jpeg":"p"==e[11]&&(t="png")),t}},s.prototype._adjustElementsSize=function(t,o){for(var n=e("[data-sizeable="+t+"]"),r=0;r<n.length;r++)for(var s=n[r],l=e(s).attr("data-cssrules").split(","),p=0;p<l.length;p++){var d=l[p],g=o;"-"==d[0]&&(d=d.substr(1),g="-"+o);var c=d.match(/:\((.+)\)/);if(c){d=d.replace(c[0],"");var m=c[1];m=m.replace("$v",g);var h=new Function("return "+m)();g=h}e(s).css(d,g+"px")}},s.prototype.detectPlatform=function(){/iPhone|iPad|iPod/i.test(navigator.userAgent)?this.platform=r.ios:/Android|BlackBerry/i.test(navigator.userAgent)?this.platform=r.android:/IEMobile/i.test(navigator.userAgent)&&(this.platform=r.windowsMobile),this.options.detectTouch&&"Function"!==this.options.detectTouch.constructor.name&&(console.error("detectTouch should be a function which will be called when Imager needs to determine whether it is working on touch device"),this.options.detectTouch=null),this.touchDevice=this.options.detectTouch?this.options.detectTouch(this):/(iPhone|iPod|iPad|BlackBerry|Android)/i.test(navigator.userAgent);var t=this;e("body").on("touchstart.DrawerTouchCheck",function(){t.touchDevice=!0,e("body").off("touchstart.DrawerTouchCheck"),t.log("Found touch screen.")})},t.Imager=s}),modules.push(function({$:e,utilNamespace:t,translations:a}){var i=function(t){var o=this;o.acceptTypes=t,o.$element=e("<div class=\"file-selector\"><input type=\"file\" /><div class=\"drop-area\">"+a.t("Or drop files here")+"</div><div class=\"error-container bg-danger\"></div></div>"),o.acceptTypes&&o.$element.find("input").attr("accept",o.acceptTypes),o.$element.find("input").on("change",function(t){1>t.target.files.length&&o.showError(a.t("No file selected."));for(var e=0;e<t.target.files.length;e++)if(0>t.target.files[e].type.indexOf("image"))return void o.showError(a.t("Incorrect file type"));o.parseFile(t.target.files[0])});var n=o.$element.find(".drop-area");n.on("dragover",function(t){t.stopPropagation(),t.preventDefault(),n.addClass("hover")}),n.on("dragleave",function(t){t.stopPropagation(),t.preventDefault(),n.removeClass("hover")}),n.on("drop",function(t){t.stopPropagation(),t.preventDefault(),n.removeClass("hover");var e=t.originalEvent.dataTransfer.files;if(1>e.length)return void o.showError(a.t("No file selected."));for(var r=0;r<e.length;r++)if(0>e[r].type.indexOf("image"))return void o.showError(a.t("Incorrect file type."));o.parseFile(e[0])})};i.prototype.parseFile=function(e){var t=this,a=new FileReader;a.onload=function(){t.$element.trigger("fileSelected.fileSelector",{info:e,data:a.result})},a.readAsDataURL(e)},i.prototype.onFileSelected=function(e){var t=this;t.$element.on("fileSelected.fileSelector",function(t,a){e(a)})},i.prototype.showError=function(e){var t=this;t.$element.find(".error-container").html(e),t.$element.find(".error-container").slideDown(200),setTimeout(function(){t.$element.find(".error-container").slideUp(200)},2e3)},i.prototype.getElement=function(){return this.$element},i.prototype.hide=function(){this.$element.hide()},i.prototype.show=function(){this.$element.show()},t.FileSelector=i}),modules.push(function({$:e,utilNamespace:t}){t.uuid=function(){var e=new Date().getTime(),t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var a=0|(e+16*Math.random())%16;return e=Math.floor(e/16),("x"==t?a:8|3&a).toString(16)});return t}}),modules.push(function({$:e,utilNamespace:t}){t.getDrawerFolderUrl=function(){for(var e,t=document.getElementsByTagName("script"),a=/dist\/(drawer.+\.js)+$/,o=0;o<t.length;o++)if(e=t.item(o),e.src){var n=e.src.match(a);if(n){var r=e.src.replace(n[1],"");return r}}return null},t.unbindClick=function(t,a){var i=a+"drawerBindClick";e(t).off("click."+i),e(t).off("touchstart."+i),e(t).off("touchend."+i)},t.bindClick=function(t,a,i){var o=a+"drawerBindClick";e(t).on("click."+o,function(e){var t=this,a=null;if(t.__lastClickTime){var o=Date.now()-t.__lastClickTime;if(!(500<o));else if(a=i.apply(t,[e]),!1===a)return e.stopPropagation(),e.preventDefault(),!1}else if(a=i.apply(t,[e]),!1===a)return e.stopPropagation(),e.preventDefault(),!1}),e(t).on("touchstart."+o,function(a){var i=this;i.__drawerTouchStartEvent=a,e(t).off("click."+o)}),e(t).on("touchend."+o,function(e){var t=this;if(t.__drawerTouchStartEvent){var a=Math.abs(t.__drawerTouchStartEvent.timeStamp-e.timeStamp);if(300>a){t.__lastClickTime=Date.now();var o=i.apply(t,[e]);if(!1===o)return e.stopPropagation(),e.preventDefault(),!1}delete t.__drawerTouchStartEvent}})},t.bindDoubleTap=function(t,a,i){var o=20;e(t).on("touchend."+a,function(e){var t=this;if(t.__touchEndTime){var a=Date.now()-t.__touchEndTime,n=Math.abs(t.__touchEndX-e.originalEvent.pageX),r=Math.abs(t.__touchEndY-e.originalEvent.pageY);if(a<500&&n<o&&r<o){delete t.__touchEndTime,delete t.__touchEndX,delete t.__touchEndY;var s=i.apply(t,[e]);if(!1===s)return e.stopPropagation(),e.preventDefault(),!1}else delete t.__touchEndTime,delete t.__touchEndX,delete t.__touchEndY}else t.__touchEndTime=Date.now(),t.__touchEndX=e.originalEvent.pageX,t.__touchEndY=e.originalEvent.pageY,setTimeout(function(){delete t.__touchEndTime,delete t.__touchEndX,delete t.__touchEndY},500)})},t.bindLongPress=function(t,a,i){var o=a+"drawerBindLongPress";e(t).on("touchstart."+o,function(t){var a=this;a.__touchStartTime=Date.now(),a.__touchStartX=t.originalEvent.pageX,a.__touchStartY=t.originalEvent.pageY,a.__longPressCheckTimeout&&clearTimeout(a.__longPressCheckTimeout);var n=function(){delete a.__touchStartTime,delete a.__touchStartX,delete a.__touchStartY,e(a).off("touchmove."+o),e(a).off("touchend."+o)};return e(a).on("touchmove."+o,function(e){if(a.__touchStartTime){var t=Math.abs(a.__touchStartX-e.originalEvent.pageX),i=Math.abs(a.__touchStartY-e.originalEvent.pageY);(10<t||10<i)&&n()}}),e(a).on("touchend."+o,function(){n()}),a.__longPressCheckTimeout=setTimeout(function(){if(a.__touchStartTime){n();i.apply(a,[t])}},1e3),!0})},t.unbindLongPress=function(t,a){var i=a+"drawerBindLongPress";e(t).off("touchstart."+i),e(t).off("touchmove."+i),e(t).off("touchend."+i)},t.mouseDown=function(e){return"mousedown."+e+" touchstart."+e},t.mouseMove=function(e){return"mousemove."+e+" touchmove."+e},t.mouseUp=function(e){return"mouseup."+e+" touchend."+e},t.getTransitionDuration=function(e,t){var a=window.getComputedStyle(e),i=a.webkitTransitionDuration,o=a.webkitTransitionDelay;return i=-1<i.indexOf("ms")?parseFloat(i):1e3*parseFloat(i),o=-1<o.indexOf("ms")?parseFloat(o):1e3*parseFloat(o),t?i+o:i},t.getEventPosition=function(e){return-1<e.type.indexOf("touch")&&(e=e.originalEvent,0===e.pageX&&0===e.pageY||void 0===e.pageX&&void 0===e.pageY&&0<e.touches.length)?{left:e.touches[0].pageX,top:e.touches[0].pageY}:{left:e.pageX,top:e.pageY}},t.isShape=function(e){var t=!1;return t=!(e.type&&("line"==e.type||"arrow"==e.type))&&!e.path,t},t.__temporaryCanvas=null,t.getTemporaryCanvas=function(e){return t.__temporaryCanvas||(t.__temporaryCanvas=document.createElement("canvas")),t.__temporaryCanvas.setAttribute("width",e.width),t.__temporaryCanvas.setAttribute("height",e.height),t.__temporaryCanvas},t.LastCoordsQueue=function(){this.coordsQueue=[],this.length=10,this.pushCoords=function(e,t){this.coordsQueue.length>this.length&&(this.coordsQueue=this.coordsQueue.slice(this.coordsQueue.length-this.length)),this.coordsQueue.push({x:e,y:t})},this.getInterpolatedValues=function(){if(0===this.coordsQueue.length)return[];if(1===this.coordsQueue.length)return[{x:this.coordsQueue[0].x,y:this.coordsQueue[0].y}];for(var e=[],t=this.coordsQueue[this.coordsQueue.length-2].x,a=this.coordsQueue[this.coordsQueue.length-2].y,i=this.coordsQueue[this.coordsQueue.length-1].x,o=this.coordsQueue[this.coordsQueue.length-1].y,n=i-t,r=o-a,s=Math.abs(n),l=Math.abs(r),p=s>l?s:l,d=0;d<p;d++)e.push({x:t+n/p*d,y:a+r/p*d});return e}},t.setWaiting=function(e,a,i){i||(i="wait"),t.setOverlayMessage(e,a,i)},t.stopWaiting=function(e){t.removeOverlayMessage(e)},t.setOverlayMessage=function(a,i,o,n,r){o||(o="default");var s=n?"<div class=\"action-button\">"+n+"</div>":"";e(a).append("<div class=\"overlay-message-wrapper\"><div class=\"overlay-message\">"+i+s+"</div></div>"),e(a).find(".overlay-message-wrapper").css("cursor",o),t.bindClick(e(a).find(".action-button"),"overlay-message-click",r)},t.removeOverlayMessage=function(t){e(t).find(".overlay-message-wrapper").remove()},t.resizeImage=function(e,t,a,o,n){Date.now();o=Math.round(o),n=Math.round(n);for(var r=e.getContext("2d").getImageData(0,0,t,a),s=e.getContext("2d").getImageData(0,0,o,n),l=r.data,p=s.data,d=t/o,g=a/n,c=Math.ceil(d/2),m=Math.ceil(g/2),h=0;h<n;h++)for(var u=0;u<o;u++){for(var f=4*(u+h*o),y=0,v=0,S=0,C=0,b=0,P=0,E=0,R=(h+.5)*g,x=Math.floor(h*g);x<(h+1)*g;x++)for(var I=Math.abs(R-(x+.5))/m,$=(u+.5)*d,L=Math.floor(u*d);L<(u+1)*d;L++){var T=Math.abs($-(L+.5))/c,D=Math.sqrt(I*I+T*T);-1<=D&&1>=D&&(y=2*D*D*D-3*D*D+1,0<y&&(T=4*(L+x*t),E+=y*l[T+3],S+=y,255>l[T+3]&&(y=y*l[T+3]/250),C+=y*l[T],b+=y*l[T+1],P+=y*l[T+2],v+=y))}p[f]=C/v,p[f+1]=b/v,p[f+2]=P/v,p[f+3]=E/S}e.getContext("2d").clearRect(0,0,Math.max(t,o),Math.max(a,n)),e.width=o,e.height=n,e.getContext("2d").putImageData(s,0,0)}}),modules.push(function({$:e,pluginsCatalog:t,util:a,translations:i}){var o=a.mouseDown("imagerjsCrop"),n=a.mouseUp("imagerjsCrop"),r=a.mouseMove("imagerjsCrop"),s=function(t,a){var i=this;i.weight=0,i.imager=t,i.defaultOptions={controlsCss:{},controlsTouchCss:{}},a=a?a:{},i.options=e.extend(!0,i.defaultOptions,a),i.originalWidth=null,i.originalHeight=null,i.croppedWidth=null,i.croppedHeight=null,i.croppedLeft=null,i.croppedTop=null};s.prototype.getButtons=function(){var e=this;return[{classes:"btn-crop",iconClasses:"fa-scissors",tooltip:i.t("Crop"),enabledHandler:function(){e.sizeBeforeCrop&&e.imager.setPreviewSize(e.sizeBeforeCrop.width,e.sizeBeforeCrop.height),e.enableRendering=!1,e.imager.render(),e.startCropping()},applyHandler:function(){e.sizeBeforeCrop=e.imager.getPreviewSize(),e.stopCropping(),e.enableRendering=!0,e.imager.setPreviewSize(e.croppedWidth,e.croppedHeight),e.imager.setWaiting(!0),setTimeout(function(){e.imager.commitChanges("Crop"),e.reset(),e.imager.render(),e.imager.setWaiting(!1)},50)},rejectHandler:function(){e.stopCropping(),e.croppedWidth=null,e.croppedHeight=null,e.croppedLeft=null,e.croppedTop=null,e.imager.render()}}]},s.prototype.startCropping=function(){function t(){i.$cropControls.css({left:i.croppedLeft,top:i.croppedTop,width:i.croppedWidth,height:i.croppedHeight}),i.adjustPreview()}var i=this;i.renderCropped=!1,i.imager.render();var s=e("body"),l=this.imager.getPreviewSize();i.originalWidth=l.width,i.originalHeight=l.height,i.makePreview(),i.$cropControls=e("<div class=\"imager-crop-container\"><div class=\"crop-corner crop-top-left\"></div><div class=\"crop-corner crop-top-right\"></div><div class=\"crop-corner crop-bottom-right\"></div><div class=\"crop-corner crop-bottom-left\"></div><div class=\"crop-border crop-border-top\"></div><div class=\"crop-border crop-border-right\"></div><div class=\"crop-border crop-border-bottom\"></div><div class=\"crop-border crop-border-left\"></div></div>").css({width:i.croppedWidth?i.croppedWidth:i.originalWidth,height:i.croppedHeight?i.croppedHeight:i.originalHeight,left:i.croppedLeft?i.croppedLeft:0,top:i.croppedTop?i.croppedTop:0}),i.imager.$editContainer.append(i.$cropControls);var p=i.$cropControls,d=p.find(".crop-corner");i.imager.touchDevice?d.css(i.options.controlsTouchCss):d.css(i.options.controlsCss),d.on(o,function(o){o.stopPropagation();var l=this,p=a.getEventPosition(o),d=0|i.$cropControls.css("left").replace("px",""),g=0|i.$cropControls.css("top").replace("px",""),c=0|i.$cropControls.css("width").replace("px",""),m=0|i.$cropControls.css("height").replace("px","");s.on(r,function(o){function n(){0>i.croppedLeft&&(i.croppedLeft=0),0>i.croppedTop&&(i.croppedTop=0),i.croppedLeft+i.croppedWidth>i.originalWidth&&(i.croppedWidth=i.originalWidth-i.croppedLeft),i.croppedTop+i.croppedHeight>i.originalHeight&&(i.croppedHeight=i.originalHeight-i.croppedTop)}var r=a.getEventPosition(o),s=r.left-p.left,h=r.top-p.top;return e(l).hasClass("crop-top-left")&&(i.croppedLeft=d+s,i.croppedTop=g+h,i.croppedWidth=c-s,i.croppedHeight=m-h,o.shiftKey&&(n(),i.croppedHeight<i.croppedWidth?(i.croppedWidth=i.croppedHeight,i.croppedLeft=c-i.croppedHeight+d):(i.croppedHeight=i.croppedWidth,i.croppedTop=m-i.croppedWidth+g))),e(l).hasClass("crop-top-right")&&(i.croppedLeft=d,i.croppedTop=g+h,i.croppedWidth=c- -1*s,i.croppedHeight=m-h,o.shiftKey&&(n(),i.croppedHeight<i.croppedWidth?i.croppedWidth=i.croppedHeight:(i.croppedHeight=i.croppedWidth,i.croppedTop=m-i.croppedHeight+g))),e(l).hasClass("crop-bottom-right")&&(i.croppedLeft=d,i.croppedTop=g,i.croppedWidth=c- -1*s,i.croppedHeight=m+h,o.shiftKey&&(n(),i.croppedHeight<i.croppedWidth?i.croppedWidth=i.croppedHeight:i.croppedHeight=i.croppedWidth)),e(l).hasClass("crop-bottom-left")&&(i.croppedLeft=d+s,i.croppedTop=g,i.croppedWidth=c-s,i.croppedHeight=m+h,o.shiftKey&&(n(),i.croppedHeight<i.croppedWidth?(i.croppedWidth=i.croppedHeight,i.croppedLeft=d+(c-i.croppedWidth)):i.croppedHeight=i.croppedWidth)),n(),t(),o.preventDefault(),o.stopPropagation(),!1}),s.on(n,function(){s.off(r),s.off(n)})}),p.on(o,function(e){var o=this,l=a.getEventPosition(e),p=0|i.$cropControls.css("left").replace("px",""),d=0|i.$cropControls.css("top").replace("px","");s.on(r,function(e){var o=a.getEventPosition(e),n=o.left-l.left,r=o.top-l.top;return i.croppedLeft=p+n,i.croppedTop=d+r,0>i.croppedLeft&&(i.croppedLeft=0),0>i.croppedTop&&(i.croppedTop=0),i.croppedLeft+i.croppedWidth>i.originalWidth&&(i.croppedLeft=i.originalWidth-i.croppedWidth),i.croppedTop+i.croppedHeight>i.originalHeight&&(i.croppedTop=i.originalHeight-i.croppedHeight),t(),e.preventDefault(),e.stopPropagation(),!1}),s.on(n,function(){s.off(r),s.off(n)})})},s.prototype.stopCropping=function(){this;this.$preview.remove(),this.$preview=null,this.$cropControls.remove(),this.$cropControls=null,this.renderCropped=!0},s.prototype.makePreview=function(){var t=this,a=this.imager.getPreviewSize();t.$preview=e("<div class=\"imager-crop-preview-container\"><canvas class=\"imager-crop-preview\"></canvas></div>").css("position","absolute").css("top","50px").css({width:a.width,height:a.height,position:"absolute",right:"50px",top:"50px"}),t.previewCanvas=t.$preview.find("canvas.imager-crop-preview")[0],t.previewCanvas.__previewCanvas=!0,t.previewCanvas.width=1.5*a.width,t.previewCanvas.height=1.5*a.height,e(t.previewCanvas).css({height:"400px"}),t.imager.$editContainer.after(this.$preview)},s.prototype.adjustPreview=function(){this},s.prototype.render=function(e){if(null!==this.croppedWidth&&this.enableRendering){var t=this.imager.getPreviewSize(),a=t.width,i=t.height;this.sizeBeforeCrop&&(a=this.sizeBeforeCrop.width,i=this.sizeBeforeCrop.height);var o=this.imager.tempCanvas.getContext("2d"),n=this.imager.convertScale(this.croppedWidth,a,e.canvas.width),r=this.imager.convertScale(this.croppedHeight,i,e.canvas.height),s=this.imager.convertScale(this.croppedLeft,a,e.canvas.width),l=this.imager.convertScale(this.croppedTop,i,e.canvas.height);s*=-1,l*=-1;var p=e.canvas.width-n,d=e.canvas.height-r;o.canvas.width=n,o.canvas.height=r,o.clearRect(0,0,o.canvas.width,o.canvas.height),o.drawImage(e.canvas,0,0,e.canvas.width,e.canvas.height,s,l,o.canvas.width+p,o.canvas.height+d),e.canvas.width=n,e.canvas.height=r,this.imager.clearCanvas(e),e.drawImage(o.canvas,0,0,o.canvas.width,o.canvas.height,0,0,e.canvas.width,e.canvas.height)}},s.prototype.onToolSelected=function(e){"RotatePlugin"==e.plugin.constructor.name&&(this.croppedLeft=null,this.croppedTop=null,this.croppedWidth=null,this.croppedHeight=null,this.sizeBeforeCrop=null)},s.prototype.deserialize=function(e){e&&(this.croppedLeft=croppedLeft,this.croppedTop=croppedTop,this.croppedWidth=croppedWidth,this.croppedHeight=croppedHeight,this.sizeBeforeCrop=sizeBeforeCrop)},s.prototype.serialize=function(){return{croppedLeft:this.croppedLeft,croppedTop:this.croppedTop,croppedWidth:this.croppedWidth,croppedHeight:this.croppedHeight,sizeBeforeCrop:this.sizeBeforeCrop}},s.prototype.reset=function(){this.croppedLeft=null,this.croppedTop=null,this.croppedWidth=null,this.croppedHeight=null,this.sizeBeforeCrop=null},t.Crop=s}),modules.push(function({$:e,pluginsCatalog:t,translations:a,util:i}){var o=function(t,a){var i=this;i.imager=t,i.defaultOptions={fullRemove:!1},a=a?a:{},i.options=e.extend(!0,i.defaultOptions,a),i.weight=500};o.prototype.getButtons=function(){var e=this;return[{classes:"btn-delete",iconClasses:"fa-times",tooltip:a.t("Delete image"),enabledHandler:function(){var t=a.t("Are you sure want to delete this image?"),i=confirm(t);i&&(e.imager.setWaiting(!0),setTimeout(function(){e.options.fullRemove?e.imager.remove(!0):(e.imager.stopEditing(),e.imager.$imageElement.attr("src",""),e.imager.startSelector(),e.imager.adjustEditContainer())},1))}}]},t.Delete=o}),modules.push(function({$:e,pluginsCatalog:t,util:a,translations:i,Modal:o}){var n=a.mouseDown("MovableFloatingMode"),r=a.mouseMove("MovableFloatingMode"),s=a.mouseUp("MovableFloatingMode"),l=function(t,a){var i=this;i.imager=t,i.defaultOptions={minWidth:50,minHeight:50},a=a?a:{},i.options=e.extend(!0,i.defaultOptions,a),i.weight=100,i.imager.log("[PropertiesPlugin]","init")};l.prototype.getButtons=function(){var e=this;return[{classes:"btn-properties",iconClasses:"fa-cog",tooltip:i.t("Image properties"),enabledHandler:function(){e.showPropertiesModal()}}]},l.prototype.showPropertiesModal=function(){var t=this,a=new o;a.setTitle(i.t("Image properties")),a.addClass("canvas-properties imager-click-stop");var n=e("<div class=\"image-properties\"><form class=\"image-size-form\"><div class=\"form-group\"><label for=\"image-properties-width\">"+i.t("Size:")+" </label><input type=\"text\" class=\"form-control\" id=\"image-properties-width\" placeholder=\""+i.t("width in px")+"\"><span>x</span><input type=\"email\" class=\"form-control\" id=\"image-properties-height\" placeholder=\""+i.t("height in px")+"\"></div></form><br><form class=\"aligment\"><div class=\"form-group\"><label for=\"image-properties-layout\">Aligment:</label><select id=\"image-properties-layout\" class=\"form-control layout-selector\"><option value=\"left\">"+i.t("Left")+"</option><option value=\"right\">"+i.t("Right")+"</option><option value=\"center\">"+i.t("Center")+"</option><option value=\"inline\">"+i.t("Inline")+"</option><option value=\"floating\">"+i.t("Floating")+"</option></select></div></form><form class=\"background-transparency\"><div class=\"form-group\"><input id=\"image-properties-transparent-background\" type=\"checkbox\" checked><label for=\"image-properties-transparent-background\">"+i.t("Transparent background")+"</label></div></form></div>");"floating"==this.getAlign()?n.find(".background-transparency").show():n.find(".background-transparency").hide();var r=t.imager.$imageElement.css("background-color");"transparent"==r||"rgba(0, 0, 0, 0)"==r?n.find("#image-properties-transparent-background").attr("checked","checked"):n.find("#image-properties-transparent-background").removeAttr("checked");var s=this.imager.getPreviewSize(),l=s.height/s.width,p=s.width/s.height,d=this.getAlign();n.find("#image-properties-width").val(s.width),n.find("#image-properties-width").on("change keyup",function(){var e=n.find("#image-properties-width").val(),t=Math.floor(e*l);n.find("#image-properties-height").val(t)}),n.find("#image-properties-height").val(s.height),n.find("#image-properties-height").on("change keyup",function(){var e=n.find("#image-properties-height").val(),t=Math.floor(e*p);n.find("#image-properties-width").val(t)}),n.find("#image-properties-layout").val(d),n.find("#image-properties-layout").change(function(){"floating"==e("#image-properties-layout").val()?n.find(".background-transparency").show():n.find(".background-transparency").hide()}),a.setTemplate(n),a.addCancelButton(i.t("Cancel"),function(){a.remove()}),a.addActionButton(i.t("Apply"),function(){var i=e("#image-properties-width").val(),o=e("#image-properties-height").val(),n=e("#image-properties-layout").val(),r=e("#image-properties-transparent-background").attr("checked");r?(t.imager.$editContainer.css("background","transparent"),t.imager.$imageElement.css("background","transparent")):(t.imager.$editContainer.css("background","white"),t.imager.$imageElement.css("background","white")),t.imager.render(),n!=t.getAlign()&&t.setAlign(n),t.imager.setPreviewSize(i,o),a.remove()}),a.show()},l.prototype.setAlign=function(e){var t={};"floating"==e?(t.position="absolute",t.display="block",t.float="none",t.left="0px",t.top="0px"):"center"==e?(t.float="none",t["margin-left"]="auto",t["margin-right"]="auto",t.display="block",t.position="static"):"inline"==e?(t.float="none",t.display="inline-block",t.position="static"):(t.display="block",t.float=e,t.position="static"),this.imager.$imageElement.css(t),this.onEditStart(),this.imager.adjustEditContainer()},l.prototype.getAlign=function(){var e=this.imager.$imageElement.css(["position","float","display","margin-left","margin-right"]),t="inline";return"absolute"==e.position?t="floating":"left"==e.float?t="left":"right"==e.float?t="right":"block"==e.display&&"auto"==e["margin-left"]&&(t="center"),t},l.prototype.onEditStart=function(){var e=this.getAlign();"floating"==e?this.makeMoveButton():this.$moveButton&&(this.$moveButton.remove(),this.$moveButton=null)},l.prototype.makeMoveButton=function(){var t=this,a=t.imager.getPluginInstance("Toolbar").toolbar,o=e("body");this.$moveButton=a.addButton("btn-move","fa-arrows",i.t("Move image"),function(){}),this.$moveButton.on(n,function(a){-1<a.type.indexOf("touch")&&(a=a.originalEvent),e(".tooltip-btn-move").css("display","none");var i=0|t.imager.$imageElement.css("left").replace("px",""),n=0|t.imager.$imageElement.css("top").replace("px",""),l=a.pageX,p=a.pageY;o.on(r,function(e){-1<e.type.indexOf("touch")&&(e=e.originalEvent);var a=e.pageX-l,o=e.pageY-p,r=i+a,s=n+o;return 0>r&&(r=0),0>s&&(s=0),t.imager.$imageElement.css({left:r,top:s}),t.imager.adjustEditContainer(),e.preventDefault(),e.stopPropagation(),!1}),o.on(s,function(){e(".tooltip-btn-move").css("display","block"),o.off(r),o.off(s)})})},t.Properties=l}),modules.push(function({$:e,pluginsCatalog:t,util:a}){var i=a.mouseDown("imagerjsResize"),o=a.mouseUp("imagerjsResize"),n=a.mouseMove("imagerjsResize"),r=function(t,a){var i=this;i.imager=t,i.defaultOptions={minWidth:50,minHeight:50,controlsCss:{},controlsTouchCss:{},doubleDiff:!1},a=a?a:{},i.options=e.extend(!0,i.defaultOptions,a),i.weight=99999};r.prototype.onToolSelected=function(){this.$resizeSquare&&this.$resizeSquare.addClass("hidden")},r.prototype.onToolApply=function(){this.$resizeSquare&&this.$resizeSquare.removeClass("hidden")},r.prototype.onToolReject=function(){this.$resizeSquare&&this.$resizeSquare.removeClass("hidden")},r.prototype.onEditStart=function(){var t=this,r=e("<div class=\"resize-square\"></div>");t.imager.touchDevice?r.css(t.options.controlsTouchCss):r.css(t.options.controlsCss),t.imager.$editContainer.append(r);var s=e("body");r.on(i,function(e){var i=a.getEventPosition(e),r=t.imager.getPreviewSize(),l=r.height/r.width,p=r.width/r.height;return s.on(n,function(e){var o=a.getEventPosition(e),n=o.left-i.left,s=o.top-i.top;t.options.doubleDiff&&(n*=2,s*=2);var l=r.width+n,p=r.height+s,d=t.calcAspectRatio(r.width,r.height,l,p);return l=d.width,p=d.height,l<t.options.minWidth&&(l=t.options.minWidth),p<t.options.minHeight&&(p=t.options.minHeight),t.imager.setPreviewSize(l,p),e.stopPropagation(),e.preventDefault(),!1}),s.on(o,function(){s.off(o),s.off(n)}),e.stopPropagation(),e.preventDefault(),!1}),this.$resizeSquare=r},r.prototype.calcAspectRatio=function(e,t,a,i){var o=Math.min(a/e,i/t);return{width:e*o,height:t*o}},t.Resize=r}),modules.push(function({$:e,pluginsCatalog:t,util:a,translations:i}){var o=a.mouseDown("imagerjsRotate"),n=a.mouseUp("imagerjsRotate"),r=a.mouseMove("imagerjsRotate"),s=function(t,a){var i=this;i.imager=t,i.defaultOptions={controlsCss:{},controlsTouchCss:{}},a=a?a:{},i.options=e.extend(!0,i.defaultOptions,a),i.weight=-100,i.angle=0;var o=this.imager.getPreviewSize();i.controlsStartWidth=o.width,i.controlsStartHeight=o.height,i.widthDiff=0,i.heightDiff=0};s.prototype.getButtons=function(){var e=this,t={name:"Rotate",tooltip:i.t("Rotate")};return[{classes:"btn-rotate",iconClasses:"fa-repeat",tooltip:i.t("Rotate manually"),group:t,enabledHandler:function(){e.startRotate(),e.imager.render()},applyHandler:function(){e.imager.setWaiting(!0),setTimeout(function(){e.applyHandler(),e.imager.commitChanges("Rotate"),e.reset(),e.imager.setWaiting(!1)},50)},rejectHandler:function(){e.setAngle(0),e.stopRotate()}},{group:t,classes:"btn-rotate btn-rotate-90",iconClasses:"fa-undo",tooltip:i.t("Rotate 90 left"),enabledHandler:function(){e.imager.setWaiting(!0),setTimeout(function(){e.rotateByAngle(-90*Math.PI/180),e.imager.setWaiting(!1)},50)}},{group:t,classes:"btn-rotate",iconClasses:"fa-repeat",tooltip:i.t("Rotate 90 right"),enabledHandler:function(){e.imager.setWaiting(!0),setTimeout(function(){e.rotateByAngle(90*Math.PI/180),e.imager.setWaiting(!1)},50)}}]},s.prototype.applyHandler=function(){this.stopRotate()},s.prototype.rotateByAngle=function(e){var t=this.imager.quality,a=this.imager.targetScale;this.imager.quality=1,this.imager.targetScale=1,this.startRotate(),this.imager.render(),this.setAngle(e),this.imager.render(),this.stopRotate(),this.imager.commitChanges(i.t("Rotate")),this.reset(),this.imager.render(),this.imager.quality=t,this.imager.targetScale=a},s.prototype.startRotate=function(){var t=this,i=this.imager.getPreviewSize();t.controlsStartWidth=t.imager.originalPreviewWidth,t.controlsStartHeight=t.imager.originalPreviewHeight;var s=e("<div class=\"imager-rotate-container\"><div class=\"rotate-corner rotate-top-left\"></div><div class=\"rotate-corner rotate-top-right\"></div><div class=\"rotate-corner rotate-bottom-right\"></div><div class=\"rotate-corner rotate-bottom-left\"></div><div class=\"rotate-border rotate-border-top\"></div><div class=\"rotate-border rotate-border-right\"></div><div class=\"rotate-border rotate-border-bottom\"></div><div class=\"rotate-border rotate-border-left\"></div></div>").css({width:t.controlsStartWidth,height:t.controlsStartHeight});this.$rotateControls=s,this.imager.$editContainer.append(s);var l=s.find(".rotate-corner");t.imager.touchDevice?l.css(t.options.controlsTouchCss):l.css(t.options.controlsCss);var p=e("body"),d=e(this.imager.canvas).offset();t.centerX=d.left+this.controlsStartWidth/2,t.centerY=d.top+this.controlsStartHeight/2,t.setAngle(t.angle),l.on(o,function(e){t.prevAngle=-1*t.angle;var i=a.getEventPosition(e),o=t.getAngle(t.centerX,t.centerY,i.left,i.top);return p.on(r,function(e){var i=a.getEventPosition(e),n=t.getAngle(t.centerX,t.centerY,i.left,i.top);return t.angle=t.prevAngle+(o-n),t.angle*=-1,t.setAngle(t.angle),e.preventDefault(),e.stopPropagation(),!1}),p.on(n,function(){p.off(n),p.off(r),t.lastAngle=t.angle}),e.preventDefault(),e.stopPropagation(),!1})},s.prototype.stopRotate=function(){this.$rotateControls.remove(),this.$rotateControls=null},s.prototype.setAngle=function(e){this.angle=e,this.$rotateControls.css("-webkit-transform","rotate("+e+"rad)");var t=this.getRotatedDimensions(this.controlsStartWidth,this.controlsStartHeight,e);this.widthDiff=t.width-this.controlsStartWidth,this.heightDiff=t.height-this.controlsStartHeight,this.$rotateControls.css({top:this.heightDiff/2,left:this.widthDiff/2}),this.imager.setPreviewSize(t.width,t.height),this.imager.render()},s.prototype.render=function(e){var t=this.imager.tempCanvas.getContext("2d");t.clearRect(0,0,t.canvas.width,t.canvas.height);var a=this.imager.convertScale(this.widthDiff,this.controlsStartWidth,e.canvas.width),i=this.imager.convertScale(this.heightDiff,this.controlsStartHeight,e.canvas.height);t.canvas.width=e.canvas.width+a,t.canvas.height=e.canvas.height+i,this.rotateCanvas(t,this.angle),t.translate(a/2,i/2),t.drawImage(e.canvas,0,0,e.canvas.width,e.canvas.height,0,0,e.canvas.width,e.canvas.height),t.translate(-a/2,-i/2),this.restoreCanvasRotation(t,this.angle),e.canvas.width+=a,e.canvas.height+=i,this.imager.clearCanvas(e);var o=0,n=0;this.$rotateControls&&(o=this.imager.convertScale(10,this.controlsStartWidth,e.canvas.width),n=this.imager.convertScale(10,this.controlsStartHeight,e.canvas.height)),e.drawImage(t.canvas,0,0,t.canvas.width,t.canvas.height,o,n,e.canvas.width-2*o,e.canvas.height-2*n)},s.prototype.rotateCanvas=function(e,t){e.translate(e.canvas.width/2,e.canvas.height/2),e.rotate(t),e.translate(-e.canvas.width/2,-e.canvas.height/2)},s.prototype.restoreCanvasRotation=function(e,t){e.translate(e.canvas.width/2,e.canvas.height/2),e.rotate(-1*t),e.translate(-e.canvas.width/2,-e.canvas.height/2)},s.prototype.getRotatedDimensions=function(e,t,i){0>i&&(i*=-1),i>2*Math.PI&&(i-=2*Math.PI,i=2*Math.PI-i),i>Math.PI&&(i-=Math.PI,i=Math.PI-i),i>Math.PI/2&&(i-=Math.PI/2,i=Math.PI/2-i);var o=e*Math.cos(i),a=t*Math.sin(i),n=e*Math.sin(i),r=t*Math.cos(i);return{width:o+a,height:n+r}},s.prototype.getAngle=function(e,t,a,i){return Math.atan2(i-t,a-e)},s.prototype.deserialize=function(e){e&&e.angle&&(this.angle=e.angle)},s.prototype.serialize=function(){return{angle:this.angle}},s.prototype.reset=function(){this.widthDiff=0,this.heightDiff=0,this.angle=0},t.Rotate=s}),modules.push(function({$:e,pluginsCatalog:t,util:a,translations:i}){var o=function(t,a){var i=this;i.imager=t,i.defaultOptions={upload:!1,uploadFunction:null},a=a?a:{},i.options=e.extend(!0,i.defaultOptions,a)};o.prototype.getButtons=function(){var e=this;return[{classes:"btn-save",iconClasses:"fa-save",tooltip:i.t("Save"),enabledHandler:function(){var t=e.imager.options.contentConfig,a=t?t.saveImageData:null;e.options.upload&&(a=e.options.uploadFunction),a?a.call(e.imager,e.imager.$imageElement.attr("data-imager-id"),e.imager.$imageElement.attr("src"),function(t){e.imager.stopEditing(),e.imager.$imageElement.attr("src",t)}):console.error("No uploadFunction function provided in imager.options.contentConfig.saveImageData.")}}]},t.Save=o}),modules.push(function({$:e,pluginsCatalog:t,translations:a,Toolbar:i,namespace:o}){var n=function(t,a){var i=this;i.imager=t,a=a||{};var o={tooltipEnabled:!0,tooltipCss:null};i.imager.touchDevice&&(o.tooltipEnabled=!1),i.options=e.extend(o,a),i.activeButton=null,i.weight=-100};n.prototype.onEditStart=function(){var e=this;e.toolbar=new o.Toolbar(e.options),e.toolbar.getElement().attr("data-sizeable","toolbar-button").attr("data-cssrules","top:($v * -1)");for(var t=e.imager.invokePluginsMethod("getButtons"),a=0;a<t.length;a++)for(var n,r=t[a].instance,s=t[a].result,l=0;l<s.length;l++){n=s[l],n.plugin=r;var p=null;p=void 0===n.group?e.toolbar.addButton(n.classes,n.iconClasses,n.tooltip,e.createHandler(n)):e.toolbar.addButtonToGroup(n.classes,n.iconClasses,n.tooltip,n.group,e.createHandler(n)),n.buttonCreatedHandler&&n.buttonCreatedHandler(p)}e.imager.$editContainer.append(e.toolbar.getElement())},n.prototype.onRemove=function(){this.toolbar&&this.toolbar.remove()},n.prototype.onEditStop=function(){this.toolbar&&this.toolbar.remove()},n.prototype.createHandler=function(e){var t=this;return function(){return t.activeButton&&t.activeButton.disabledHandler&&t.activeButton.disabledHandler(),t.toolbar.clearActiveButton(),e.enabledHandler(),e.applyHandler&&e.rejectHandler&&(t.activeButton=e,t.imager.trigger("toolSelected",e),t.toolbar.setActiveButton(e.classes),t.toolbar.getElement().addClass("hidden"),t.createOperationToolbar(e)),!1}},n.prototype.createOperationToolbar=function(e){var t=this;t.operationToolbar=new o.Toolbar(t.options),t.operationToolbar.addButton("btn-accept","fa-check",a.t("Apply"),function(){return e.applyHandler(),t.operationButtonHandler(),t.imager.trigger("toolApply"),!1}),t.operationToolbar.addButton("btn-reject","fa-times",a.t("Reject"),function(){return e.rejectHandler(),t.operationButtonHandler(),t.imager.trigger("toolReject"),!1}),t.imager.$editContainer.append(t.operationToolbar.getElement())},n.prototype.operationButtonHandler=function(){this.activeButton=null,this.removeOperationToolbar(),this.toolbar.getElement().removeClass("hidden"),this.toolbar.clearActiveButton()},n.prototype.removeOperationToolbar=function(){this.operationToolbar.remove(),this.operationToolbar=null},n.prototype.getActiveButton=function(){return this.activeButton},t.Toolbar=n}),modules.push(function({$:e,pluginsCatalog:t,util:a,translations:i}){var o=function(t,a){var i=this;i.imager=t,i.$toolbarButton=null,a=a?a:{},i.options=e.extend(!0,i.defaultOptions,a)};o.prototype.getButtons=function(){var e=this;return[{classes:"btn-undo",iconClasses:"fa-undo",tooltip:i.t("Undo"),buttonCreatedHandler:function(t){e.$toolbarButton=t},enabledHandler:function(t){e.toolbar=t,e.imager.setWaiting(!0),setTimeout(function(){e.imager.historyUndo(),e.imager.setWaiting(!1)},50)}}]},o.prototype.onHistoryChange=function(){1<this.imager.history.length?(this.$toolbarButton.css({"pointer-events":"all"}),this.$toolbarButton.find("a").css("color","#333")):(this.$toolbarButton.css({"pointer-events":"none"}),this.$toolbarButton.find("a").css("color","#C3C3C3"))},t.Undo=o});export default function init({$:e,namespace:t}){const a={namespace:t,util:ImagerJs.util,utilNamespace:ImagerJs.util,translations:ImagerJs.translations,pluginsCatalog:ImagerJs.plugins,Modal:window.Modal,$:e};return modules.forEach(e=>{e(a)}),ImagerJs}